<!DOCTYPE html>
<html lang="is">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Afm√¶li mitt</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@300;400;500&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

:root {
  --bg: #0d0f14;
  --surface: #161a22;
  --surface-hover: #202735;
  --text: #f9fafb;
  --text-muted: #a8b1c2;
  --border: #2a3242;
  --border-light: #3a465c;
  --primary: #d4af37;
  --primary-text: #0a0b10;
  --secondary: #6b7280;
  --accent: #f5d77a;
  --danger: #e05252;
  --success: #2fb36d;
  --warning: #d99b24;
  --shadow: rgba(0, 0, 0, 0.52);
  --glow: rgba(212, 175, 55, 0.26);
  --gradient: linear-gradient(160deg, rgba(212, 175, 55, 0.16), rgba(20, 24, 35, 0.92));
  --overlay-surface: rgba(16, 20, 30, 0.88);
  --grid-line: rgba(245, 215, 122, 0.04);
  --party-string: rgba(255,255,255,0.18);
  --party-sparkle: rgba(255,255,255,0.75);
  --balloon-1: var(--accent);
  --balloon-2: var(--success);
  --balloon-3: #a78bfa;
  --balloon-4: var(--warning);
  --balloon-5: var(--danger);
  --balloon-6: #f472b6;

  /* Legacy aliases kept to avoid layout/flow changes in existing shell */
  --bg-dark: var(--bg);
  --bg-card: var(--surface);
  --bg-card-hover: var(--surface-hover);
  --text-primary: var(--text);
  --text-secondary: var(--text-muted);
  --accent-dim: color-mix(in srgb, var(--accent) 18%, transparent);
  --accent-glow: var(--glow);
  --green: var(--success);
  --green-dim: color-mix(in srgb, var(--success) 18%, transparent);
  --amber: var(--warning);
  --amber-dim: color-mix(in srgb, var(--warning) 18%, transparent);
  --red: var(--danger);
  --red-dim: color-mix(in srgb, var(--danger) 18%, transparent);
  --purple: #a78bfa;
  --purple-dim: color-mix(in srgb, #a78bfa 18%, transparent);
  --radius: 12px;
  --font-body: 'Outfit', sans-serif;
  --font-mono: 'DM Mono', monospace;
}

html { font-size: 16px; scroll-behavior: smooth; }
body { font-family: var(--font-body); background: var(--bg-dark); color: var(--text-primary); overflow-x: hidden; }
.retro-bg {
  position: fixed;
  inset: 0;
  z-index: 1;
  pointer-events: none;
  overflow: hidden;
  background:
    linear-gradient(180deg, rgba(9, 14, 28, 0.75), rgba(8, 10, 18, 0.86)),
    repeating-linear-gradient(0deg, rgba(255,255,255,0.025) 0 2px, transparent 2px 4px),
    repeating-linear-gradient(90deg, rgba(245, 215, 122, 0.035) 0 1px, transparent 1px 18px);
}
.retro-bg::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(transparent 0%, rgba(0, 0, 0, 0.2) 100%);
  opacity: 0.6;
}
.retro-sprite {
  position: absolute;
  width: 14px;
  height: 14px;
  image-rendering: pixelated;
  opacity: 0.8;
  animation: retroFloat linear infinite;
}
.retro-sprite.coin {
  background:
    radial-gradient(circle at 36% 34%, #fff6c4 0 20%, transparent 20% 100%),
    radial-gradient(circle, #f7cc45 0 58%, #c08314 58% 100%);
  border: 1px solid rgba(0,0,0,0.25);
  border-radius: 2px;
}
.retro-sprite.star {
  clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 94%, 50% 72%, 21% 94%, 32% 57%, 2% 35%, 39% 35%);
  background: linear-gradient(180deg, #fff3a0, #f6b61f);
}
@keyframes retroFloat {
  from { transform: translateY(104vh) translateX(0) rotate(0deg); }
  to { transform: translateY(-18vh) translateX(26px) rotate(360deg); }
}
.retro-badge {
  position: fixed;
  top: 10px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 9;
  pointer-events: none;
  font-family: var(--font-mono);
  font-size: 0.64rem;
  text-transform: uppercase;
  letter-spacing: 0.12em;
  color: #fff7d2;
  border: 1px solid color-mix(in srgb, var(--accent) 60%, var(--border-light));
  border-radius: 999px;
  padding: 0.32rem 0.56rem;
  background: color-mix(in srgb, #11182a 80%, transparent);
  box-shadow: 0 0 20px color-mix(in srgb, var(--accent) 24%, transparent);
}

.desktop-wrapper { display: none; }

@media (min-width: 769px) {
  .desktop-wrapper {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 3rem;
    height: 100vh;
    overflow: hidden;
    padding: 1.5rem;
    background: var(--bg);
    background-image:
      radial-gradient(ellipse at 20% 50%, var(--grid-line) 0%, transparent 60%),
      radial-gradient(ellipse at 80% 50%, color-mix(in srgb, var(--success) 10%, transparent) 0%, transparent 60%);
    position: relative;
  }
  .desktop-wrapper::before {
    content: '';
    position: absolute;
    inset: 0;
    background-image:
      linear-gradient(var(--grid-line) 1px, transparent 1px),
      linear-gradient(90deg, var(--grid-line) 1px, transparent 1px);
    background-size: 60px 60px;
    pointer-events: none;
    mask-image: radial-gradient(ellipse at 50% 50%, black 30%, transparent 70%);
  }
  .desktop-story {
    flex: 1;
    max-width: 460px;
    padding: 1.2rem;
    display: grid;
    gap: 1rem;
    align-content: center;
  }
  .gift-pack {
    position: relative;
    border: 1px solid var(--border-light);
    border-radius: 18px;
    padding: 1rem;
    background: linear-gradient(165deg, color-mix(in srgb, var(--accent) 14%, transparent), color-mix(in srgb, var(--surface) 92%, transparent));
    box-shadow: 0 16px 40px color-mix(in srgb, var(--shadow) 60%, transparent);
    overflow: hidden;
    opacity: 0;
    animation: fadeUp 0.65s ease forwards 0.2s;
  }
  .gift-pack::before {
    content: '';
    position: absolute;
    left: 50%;
    top: -20%;
    transform: translateX(-50%);
    width: 12px;
    height: 140%;
    background: linear-gradient(180deg, #f4e2ac, #c4972f);
    border-radius: 999px;
    opacity: 0.85;
  }
  .gift-lid {
    margin: 0 auto 0.75rem;
    width: 92%;
    height: 38px;
    border: 1px solid color-mix(in srgb, var(--accent) 70%, var(--border-light));
    border-radius: 10px;
    background: linear-gradient(180deg, color-mix(in srgb, var(--accent) 35%, transparent), color-mix(in srgb, var(--surface) 88%, transparent));
    transform-origin: center bottom;
    transition: transform 0.8s cubic-bezier(.21,.9,.2,1), opacity 0.6s ease;
  }
  .desktop-wrapper.gift-open .gift-lid {
    transform: translateY(-22px) rotateX(68deg);
    opacity: 0.1;
  }
  .invite-card {
    position: relative;
    border: 1px solid var(--border-light);
    border-radius: 14px;
    background: color-mix(in srgb, var(--bg) 68%, transparent);
    padding: 1rem;
  }
  .invite-card .eyebrow {
    font-family: var(--font-mono);
    font-size: 0.68rem;
    letter-spacing: 0.14em;
    text-transform: uppercase;
    color: var(--accent);
  }
  .invite-card h1 {
    margin-top: 0.45rem;
    font-size: 2.05rem;
    font-weight: 700;
    line-height: 1.1;
  }
  .invite-card h1 .highlight { color: var(--accent); }
  .invite-card p {
    margin-top: 0.7rem;
    font-size: 0.94rem;
    line-height: 1.6;
    color: var(--text-secondary);
  }
  .gift-actions { margin-top: 0.85rem; display: flex; gap: 0.6rem; flex-wrap: wrap; }

  .phone-wrapper {
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transform: translateY(20px) scale(0.94);
    transition: opacity 0.65s ease, transform 0.65s cubic-bezier(.22,1,.36,1);
  }
  .desktop-wrapper.gift-open .phone-wrapper {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
  .phone-frame {
    width: 390px;
    height: 844px;
    border-radius: 48px;
    border: 4px solid var(--border-light);
    background: var(--bg-dark);
    overflow: hidden;
    position: relative;
    box-shadow: 0 0 60px var(--glow), 0 0 120px var(--shadow);
  }
  .phone-frame::before {
    content: '';
    position: absolute;
    top: 0; left: 50%; transform: translateX(-50%);
    width: 160px; height: 32px;
    background: var(--surface);
    border-radius: 0 0 20px 20px;
    z-index: 10;
  }
  .phone-content {
    height: 100%;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }
  .phone-content::-webkit-scrollbar { width: 0; }

  .desktop-right {
    width: min(360px, 30vw);
    max-height: 88vh;
    border: 1px solid var(--border-light);
    border-radius: 18px;
    background: color-mix(in srgb, var(--surface) 90%, transparent);
    box-shadow: 0 20px 45px color-mix(in srgb, var(--shadow) 65%, transparent);
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }
  .desktop-admin-head {
    padding: 1rem 1rem 0.75rem;
    border-bottom: 1px solid var(--border);
    background: linear-gradient(180deg, color-mix(in srgb, var(--accent) 14%, transparent), transparent);
  }
  .desktop-admin-title { font-size: 1rem; font-weight: 700; }
  .desktop-admin-sub { margin-top: 0.2rem; font-size: 0.78rem; color: var(--text-secondary); }
  .desktop-admin-body {
    padding: 0.9rem;
    display: grid;
    gap: 0.65rem;
    overflow: auto;
  }
  .desktop-admin-row { display: grid; grid-template-columns: 1fr; gap: 0.5rem; }
  .desktop-admin-row input {
    width: 100%;
    border: 1px solid var(--border-light);
    border-radius: 10px;
    background: color-mix(in srgb, var(--bg) 82%, transparent);
    color: var(--text-primary);
    padding: 0.58rem 0.66rem;
    font-size: 0.84rem;
  }
  .desktop-admin-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0.5rem;
  }
  .desktop-admin-kpi {
    border: 1px solid var(--border-light);
    border-radius: 10px;
    padding: 0.55rem 0.6rem;
    background: color-mix(in srgb, var(--bg) 74%, transparent);
  }
  .desktop-admin-kpi .k { font-size: 0.66rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.06em; }
  .desktop-admin-kpi .v { margin-top: 0.15rem; font-size: 0.95rem; font-weight: 700; }
  .desktop-admin-log {
    max-height: 240px;
    overflow: auto;
    font-size: 0.75rem;
    color: var(--text-secondary);
    line-height: 1.45;
  }

  /* Desktop: keep nav inside simulated phone, not viewport */
  .phone-content .bottom-nav {
    position: sticky;
    left: auto;
    bottom: 0.75rem;
    transform: none;
    width: calc(100% - 1rem);
    margin: 0 auto;
    border-radius: 18px;
    z-index: 30;
  }
  .phone-content .nav-feedback {
    position: sticky;
    left: auto;
    bottom: calc(0.75rem + 62px);
    transform: none;
    width: fit-content;
    margin: 0 auto 0.35rem;
    z-index: 30;
  }

  .mobile-only { display: none !important; }
}

@media (max-width: 768px) {
  .desktop-wrapper { display: none !important; }
  .phone-content-mobile { display: block; }
}

.card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 1.25rem;
  transition: all 0.2s;
}
.card:hover { background: var(--bg-card-hover); border-color: var(--border-light); }
.stack-card { margin-bottom: 0.75rem; }

.kpi {
  display: flex;
  flex-direction: column;
  padding: 1rem 1.25rem;
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
}
.kpi-label { font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.5rem; }
.kpi-value { font-size: 1.75rem; font-weight: 700; font-family: var(--font-mono); }

.section-label {
  font-family: var(--font-mono);
  font-size: 0.7rem;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  color: var(--accent);
  margin-bottom: 0.8rem;
}

.expand-card { cursor: pointer; }
.expand-card .expand-content { max-height: 0; overflow: hidden; transition: max-height 0.4s ease; }
.expand-card.open .expand-content { max-height: 1200px; }
.expand-card .expand-indicator { transition: transform 0.3s; }
.expand-card.open .expand-indicator { transform: rotate(180deg); }

@keyframes fadeUp {
  from { opacity: 0; transform: translateY(16px); }
  to { opacity: 1; transform: translateY(0); }
}
.animate-on-scroll { opacity: 0; transform: translateY(24px); transition: opacity 0.65s cubic-bezier(0.22,1,0.36,1), transform 0.65s cubic-bezier(0.22,1,0.36,1); }
.animate-on-scroll.visible { opacity: 1; transform: translateY(0); }
.animate-on-scroll:nth-child(2) { transition-delay: 0.06s; }
.animate-on-scroll:nth-child(3) { transition-delay: 0.12s; }
.animate-on-scroll:nth-child(4) { transition-delay: 0.18s; }
.animate-on-scroll:nth-child(5) { transition-delay: 0.24s; }
.animate-on-scroll:nth-child(6) { transition-delay: 0.30s; }
.animate-on-scroll:nth-child(7) { transition-delay: 0.36s; }
.animate-on-scroll:nth-child(8) { transition-delay: 0.42s; }
.animate-on-scroll:nth-child(9) { transition-delay: 0.48s; }
.animate-on-scroll:nth-child(10) { transition-delay: 0.54s; }

.safe-top { padding-top: max(env(safe-area-inset-top), 12px); }
.safe-bottom { padding-bottom: max(env(safe-area-inset-bottom), 12px); }

.pill {
  display: inline-block;
  border: 1px solid var(--border-light);
  border-radius: 999px;
  padding: 0.2rem 0.6rem;
  font-size: 0.72rem;
  color: var(--text-secondary);
  margin-right: 0.35rem;
  margin-top: 0.35rem;
}

.btn {
  border: 1px solid var(--border-light);
  border-radius: 10px;
  padding: 0.55rem 0.8rem;
  background: color-mix(in srgb, var(--bg) 88%, #000 12%);
  color: var(--text-primary);
  font-size: 0.86rem;
  cursor: pointer;
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-height: 44px;
}
.btn.primary { background: var(--accent-dim); border-color: var(--accent); }
.btn.success { background: var(--green-dim); border-color: var(--green); }
.btn.danger { background: var(--red-dim); border-color: var(--red); }
.btn:disabled { opacity: 0.55; cursor: not-allowed; }

.link-list { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 0.6rem; }
.todo-list { padding-left: 1.1rem; margin-top: 0.5rem; }
.todo-list li { margin-bottom: 0.42rem; }
.time-item { margin-bottom: 0.5rem; }
.time-item b { color: var(--accent); }
.muted { color: var(--text-secondary); }
.hero {
  margin: 1rem;
  padding: 1.25rem;
  border-radius: var(--radius);
  border: 1px solid var(--border);
  background: var(--gradient);
  position: relative;
  overflow: hidden;
}
.hero::before {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: conic-gradient(from 0deg, transparent 0%, var(--glow) 10%, transparent 20%);
  animation: heroShimmer 8s linear infinite;
  pointer-events: none;
}
@keyframes heroShimmer {
  to { transform: rotate(360deg); }
}
.hero::after {
  content: '';
  position: absolute;
  inset: 1px;
  border-radius: calc(var(--radius) - 1px);
  background: var(--gradient);
  z-index: 0;
}
.hero > * { position: relative; z-index: 1; }
.hero-wrap { display: grid; grid-template-columns: 88px 1fr; gap: 0.9rem; align-items: center; }
.hero-photo {
  width: 88px;
  height: 88px;
  border-radius: 50%;
  border: 2px solid var(--accent);
  object-fit: cover;
  background: var(--surface-hover);
  box-shadow: 0 0 20px var(--glow), 0 0 40px color-mix(in srgb, var(--accent) 12%, transparent);
  animation: photoGlow 3s ease-in-out infinite alternate;
}
@keyframes photoGlow {
  from { box-shadow: 0 0 20px var(--glow), 0 0 40px color-mix(in srgb, var(--accent) 12%, transparent); }
  to { box-shadow: 0 0 28px var(--glow), 0 0 56px color-mix(in srgb, var(--accent) 18%, transparent); }
}
.hero-count { font-family: var(--font-mono); font-size: 0.9rem; color: var(--accent); margin-top: 0.25rem; }

/* Countdown flip-clock */
.countdown-grid {
  display: flex;
  gap: 0.35rem;
  margin-top: 0.75rem;
  justify-content: center;
}
.countdown-unit {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.15rem;
}
.countdown-unit:not(:last-child)::after {
  content: none;
}
.countdown-digits {
  display: flex;
  gap: 2px;
}
.countdown-digit {
  width: 28px;
  height: 38px;
  background: linear-gradient(180deg, var(--surface) 0%, var(--surface) 49%, color-mix(in srgb, var(--border) 40%, var(--surface)) 49%, color-mix(in srgb, var(--border) 40%, var(--surface)) 51%, color-mix(in srgb, var(--surface) 92%, #000) 51%, color-mix(in srgb, var(--surface) 92%, #000) 100%);
  border: 1px solid var(--border-light);
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: var(--font-mono);
  font-size: 1.15rem;
  font-weight: 700;
  color: var(--accent);
  text-shadow: 0 0 8px var(--glow);
  position: relative;
  overflow: hidden;
}
.countdown-digit::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 50%;
  background: linear-gradient(180deg, rgba(255,255,255,0.06), transparent);
  pointer-events: none;
}
.countdown-digit.tick {
  animation: digitTick 0.3s ease;
}
@keyframes digitTick {
  0% { transform: scaleY(1); }
  30% { transform: scaleY(0.85); }
  60% { transform: scaleY(1.04); }
  100% { transform: scaleY(1); }
}
.countdown-label {
  font-size: 0.52rem;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  color: var(--text-muted);
  font-family: var(--font-mono);
}
.countdown-sep {
  font-family: var(--font-mono);
  font-size: 1.15rem;
  font-weight: 700;
  color: var(--accent);
  opacity: 0.5;
  align-self: flex-start;
  padding-top: 0.5rem;
  animation: sepPulse 1s ease-in-out infinite;
}
@keyframes sepPulse {
  0%, 100% { opacity: 0.5; }
  50% { opacity: 1; }
}
.hero-title-row {
  display: flex;
  align-items: baseline;
  gap: 0.35rem;
}
.hero-age {
  font-family: var(--font-mono);
  font-size: 2rem;
  font-weight: 700;
  color: var(--accent);
  line-height: 1;
  text-shadow: 0 0 16px var(--glow);
}
.hero-subline {
  margin-top: 0.7rem;
  font-size: 0.82rem;
  color: var(--text-secondary);
}
.hero-actions {
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 0.45rem;
  margin-top: 0.65rem;
}
.widget-grid {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 0.5rem;
  margin-top: 0.75rem;
}
.widget-pill {
  border: 1px solid var(--border-light);
  border-radius: 10px;
  background: color-mix(in srgb, var(--bg) 74%, transparent);
  padding: 0.5rem;
}
.widget-pill .label {
  font-size: 0.64rem;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.08em;
}
.widget-pill .value {
  margin-top: 0.12rem;
  font-size: 0.88rem;
  font-weight: 700;
}
.zone {
  padding: 0 1rem 1rem;
}
.zone-shell {
  border: 1px solid var(--border);
  border-radius: 14px;
  background: color-mix(in srgb, var(--surface) 92%, transparent);
  padding: 0.75rem;
}
.zone-head {
  margin-bottom: 0.7rem;
  padding: 0.2rem 0.2rem 0.45rem;
  border-bottom: 1px dashed color-mix(in srgb, var(--border-light) 75%, transparent);
}
.zone-title {
  font-size: 0.98rem;
  font-weight: 700;
}
.zone-copy {
  margin-top: 0.15rem;
  font-size: 0.8rem;
  color: var(--text-secondary);
}
.truth-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 0.55rem;
  margin-top: 0.6rem;
}
.truth-grid .flip-face.front {
  display: flex;
  flex-direction: column;
  justify-content: center;
  gap: 0.25rem;
}
.truth-grid .flip-face.back {
  display: flex;
  align-items: center;
  font-size: 0.79rem;
}
.zone-metrics {
  padding: 0 1rem 1rem;
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 0.75rem;
}
@media (max-width: 420px) {
  .widget-grid { grid-template-columns: 1fr; }
  .truth-grid { grid-template-columns: 1fr; }
}
.quiz-title { font-weight: 600; margin-bottom: 0.45rem; color: var(--text-primary); }
.quiz-option {
  display: block;
  width: 100%;
  margin-bottom: 0.45rem;
  text-align: left;
}
.quiz-meta { font-size: 0.78rem; color: var(--text-muted); margin-bottom: 0.5rem; }
.theme-chip { font-size: 0.78rem; padding: 0.4rem 0.65rem; border-radius: 999px; border: 1px solid var(--border-light); cursor: pointer; min-height: 44px; display: inline-flex; align-items: center; }
.theme-chip.active { border-color: var(--accent); color: var(--accent); box-shadow: 0 0 0 1px var(--accent-dim) inset; }
.party-layer { position: fixed; inset: 0; pointer-events: none; overflow: hidden; z-index: 3; }
.balloon {
  position: absolute;
  bottom: -120px;
  width: 24px;
  height: 30px;
  border-radius: 50% 50% 48% 48%;
  opacity: 0.65;
  animation: balloonRise linear infinite;
}
.balloon.b1 { background: var(--balloon-1); }
.balloon.b2 { background: var(--balloon-2); }
.balloon.b3 { background: var(--balloon-3); }
.balloon.b4 { background: var(--balloon-4); }
.balloon.b5 { background: var(--balloon-5); }
.balloon.b6 { background: var(--balloon-6); }
.balloon::after {
  content: '';
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  top: 28px;
  width: 1px;
  height: 44px;
  background: var(--party-string);
}
.balloon.pop {
  opacity: 0;
  transform: scale(1.6);
  transition: opacity 0.22s ease, transform 0.22s ease;
}
.balloon.dynamite {
  background: radial-gradient(circle at 35% 28%, #7c879b 0%, #1b2231 45%, #0a0c12 100%);
  border: 1px solid #ff6b3d;
  box-shadow: 0 0 14px rgba(255, 107, 61, 0.45);
}
.balloon.dynamite::before {
  content: '';
  position: absolute;
  top: -8px;
  left: 50%;
  width: 10px;
  height: 9px;
  border-radius: 2px;
  background: linear-gradient(180deg, #ff7a59, #b63a22);
  transform: translateX(-50%) rotate(-8deg);
}
.balloon-burst {
  position: fixed;
  width: 14px;
  height: 14px;
  border-radius: 50%;
  border: 2px solid var(--accent);
  pointer-events: none;
  z-index: 12;
  animation: burstOut 0.48s ease forwards;
}
@keyframes burstOut {
  from { opacity: 0.95; transform: translate(-50%, -50%) scale(0.2); }
  to { opacity: 0; transform: translate(-50%, -50%) scale(3.2); }
}
.confetti-piece {
  position: fixed;
  width: 8px;
  height: 12px;
  border-radius: 1px;
  pointer-events: none;
  z-index: 11;
  animation: confettiDrop linear forwards;
}
@keyframes confettiDrop {
  from { opacity: 1; transform: translate(0, 0) rotate(0deg); }
  to { opacity: 0; transform: translate(var(--drift-x), var(--drift-y)) rotate(var(--spin)); }
}
.glitter {
  position: absolute;
  width: 4px;
  height: 4px;
  border-radius: 50%;
  background: var(--party-sparkle);
  animation: glitterTwinkle 3.8s ease-in-out infinite;
}
@keyframes balloonRise {
  from { transform: translateY(0) translateX(0) rotate(0deg); }
  to { transform: translateY(-120vh) translateX(28px) rotate(12deg); }
}
@keyframes glitterTwinkle {
  0%,100% { opacity: 0.15; transform: scale(0.6); }
  50% { opacity: 0.85; transform: scale(1.2); }
}
.flip-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 0.6rem; }
.flip-card { perspective: 900px; min-height: 120px; }
.flip-inner {
  position: relative;
  width: 100%;
  min-height: 120px;
  transform-style: preserve-3d;
  transition: transform 0.55s ease;
}
.flip-card.flipped .flip-inner { transform: rotateY(180deg); }
.flip-face {
  position: absolute;
  inset: 0;
  border-radius: 10px;
  border: 1px solid var(--border-light);
  background: color-mix(in srgb, var(--bg) 78%, transparent);
  padding: 0.7rem;
  backface-visibility: hidden;
}
.flip-face.back { transform: rotateY(180deg); background: var(--accent-dim); }
.fact-rotator {
  perspective: 900px;
  min-height: 132px;
  cursor: pointer;
}
.fact-rotator .flip-inner { min-height: 132px; }
.fact-rotator .flip-face.front { display: flex; flex-direction: column; justify-content: center; gap: 0.25rem; }
.fact-rotator .flip-face.back { display: flex; align-items: center; }
.fact-meta {
  font-size: 0.72rem;
  color: var(--text-muted);
  margin-top: 0.5rem;
}
.photo-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 0.55rem; margin-top: 0.7rem; }
.photo-item { border-radius: 10px; overflow: hidden; border: 1px solid var(--border-light); background: color-mix(in srgb, var(--bg) 74%, transparent); }
.photo-item img { width: 100%; height: 110px; object-fit: cover; display: block; }
.photo-item div { padding: 0.4rem 0.5rem; font-size: 0.75rem; color: var(--text-secondary); }
.wishlist-board {
  display: grid;
  gap: 0.45rem;
  margin-top: 0.35rem;
}
.wl-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 0.6rem;
  border: 1px solid var(--border-light);
  border-radius: 10px;
  background: color-mix(in srgb, var(--bg) 72%, transparent);
  padding: 0.55rem 0.65rem;
  cursor: pointer;
}
.wl-item:hover { border-color: var(--accent); }
.wl-item.done {
  border-color: color-mix(in srgb, var(--text-muted) 45%, var(--border-light));
  background: color-mix(in srgb, var(--text-muted) 14%, transparent);
  opacity: 0.72;
}
.wl-left { display: flex; align-items: center; gap: 0.45rem; min-width: 0; }
.wl-name { font-size: 0.82rem; color: var(--text-primary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.wl-badge {
  font-size: 0.66rem;
  border: 1px solid var(--border-light);
  border-radius: 999px;
  padding: 0.12rem 0.42rem;
  color: var(--text-secondary);
}
.wl-item.done .wl-badge {
  border-color: var(--text-muted);
  color: var(--text-muted);
}
.planner-grid { display: grid; gap: 0.55rem; margin-top: 0.55rem; }
.planner-grid input, .planner-grid select, .planner-grid textarea {
  width: 100%;
  border: 1px solid var(--border-light);
  border-radius: 10px;
  background: color-mix(in srgb, var(--bg) 82%, transparent);
  color: var(--text-primary);
  padding: 0.56rem 0.66rem;
  font-size: 0.84rem;
}
.planner-grid textarea { min-height: 94px; resize: vertical; }
.bottom-nav {
  position: fixed;
  left: 50%;
  bottom: max(8px, env(safe-area-inset-bottom));
  transform: translateX(-50%);
  background: color-mix(in srgb, var(--bg) 86%, transparent);
  border: 1px solid color-mix(in srgb, var(--border-light) 75%, transparent);
  border-radius: 999px;
  padding: 0.38rem;
  display: grid;
  grid-template-columns: repeat(8, minmax(0, 1fr));
  gap: 0.2rem;
  z-index: 25;
  backdrop-filter: blur(14px);
  box-shadow: 0 10px 28px color-mix(in srgb, var(--shadow) 72%, transparent);
  width: min(96vw, 620px);
}
.nav-feedback {
  position: fixed;
  left: 50%;
  bottom: calc(max(8px, env(safe-area-inset-bottom)) + 64px);
  transform: translateX(-50%);
  background: var(--overlay-surface);
  border: 1px solid var(--border-light);
  border-radius: 999px;
  color: var(--text-primary);
  font-size: 0.68rem;
  padding: 0.28rem 0.55rem;
  z-index: 25;
}
.nav-chip {
  border: 1px solid transparent;
  border-radius: 999px;
  padding: 0.36rem 0.46rem;
  font-size: 0.66rem;
  color: var(--text-secondary);
  background: transparent;
  cursor: pointer;
  min-height: 44px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  gap: 0.08rem;
}
.nav-chip:hover { border-color: var(--border-light); color: var(--text-primary); }
.nav-chip.active {
  border-color: color-mix(in srgb, var(--accent) 60%, var(--border-light));
  color: var(--accent);
  background: color-mix(in srgb, var(--accent) 14%, transparent);
  box-shadow: 0 0 0 1px color-mix(in srgb, var(--accent) 24%, transparent) inset;
  transform: translateY(-1px);
}
.nav-chip[aria-current="page"] {
  border-color: var(--accent);
}
.nav-chip .icon {
  width: 16px;
  height: 16px;
  display: block;
  filter: drop-shadow(0 0 6px color-mix(in srgb, var(--accent) 28%, transparent));
}
.nav-chip .label {
  line-height: 1;
}
.damage-glitch {
  position: relative;
  pointer-events: none;
  filter: saturate(0.15) contrast(1.25);
  animation: damageJolt 0.26s steps(2, end) 5;
}
.damage-glitch::after {
  content: 'Bilun... vi√∞ger√∞ keyrir';
  position: absolute;
  right: 8px;
  top: 8px;
  font-size: 0.62rem;
  border: 1px solid var(--danger);
  border-radius: 999px;
  padding: 0.15rem 0.35rem;
  color: var(--danger);
  background: color-mix(in srgb, var(--bg) 86%, transparent);
}
@keyframes damageJolt {
  0% { transform: translate(0, 0); }
  25% { transform: translate(-1px, 1px); }
  50% { transform: translate(1px, -1px); }
  75% { transform: translate(-1px, 0); }
  100% { transform: translate(0, 0); }
}
/* MySelfie */
.selfie-camera { position: relative; border-radius: 1rem; overflow: hidden; background: #000; aspect-ratio: 4/3; }
.selfie-camera video { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); }
.selfie-camera canvas { display: none; }
.selfie-countdown { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; font-size: 4rem; font-weight: 800; color: #fff; background: rgba(0,0,0,0.4); z-index: 2; display: none; }
.selfie-controls { display: flex; gap: 0.5rem; margin-top: 0.6rem; flex-wrap: wrap; }
.selfie-controls .btn { flex: 1; min-width: 0; }
.selfie-gallery { display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.4rem; margin-top: 0.75rem; }
.selfie-gallery img { width: 100%; aspect-ratio: 1; object-fit: cover; border-radius: 0.5rem; cursor: pointer; transition: transform 0.15s; }
.selfie-gallery img:active { transform: scale(0.96); }
.selfie-lightbox { position: fixed; inset: 0; z-index: 100; background: rgba(0,0,0,0.92); display: none; align-items: center; justify-content: center; flex-direction: column; padding: 1rem; }
.selfie-lightbox.open { display: flex; }
.selfie-lightbox img { max-width: 95%; max-height: 75vh; border-radius: 0.75rem; }
.selfie-lightbox .caption { color: #fff; margin-top: 0.5rem; font-size: 0.9rem; }
.selfie-lightbox .close-lb { position: absolute; top: 1rem; right: 1rem; background: rgba(255,255,255,0.2); border: none; color: #fff; font-size: 1.5rem; width: 44px; height: 44px; border-radius: 50%; cursor: pointer; }
/* MyKaraoke */
.karaoke-upload { display: flex; flex-direction: column; gap: 0.5rem; }
.karaoke-upload input[type="text"], .karaoke-upload textarea { padding: 0.55rem; border: 1px solid var(--border-light); border-radius: 0.5rem; background: var(--surface); color: var(--text-primary); font-size: 0.9rem; }
.karaoke-song-list { margin-top: 0.75rem; display: flex; flex-direction: column; gap: 0.4rem; }
.karaoke-song-item { display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; border-radius: 0.5rem; background: var(--surface); border: 1px solid var(--border-light); cursor: pointer; }
.karaoke-song-item .song-info { flex: 1; }
.karaoke-song-item .song-title { font-weight: 600; font-size: 0.9rem; }
.karaoke-song-item .song-artist { font-size: 0.78rem; color: var(--text-secondary); }
.karaoke-badge { display: inline-block; padding: 0.12rem 0.4rem; border-radius: 999px; font-size: 0.68rem; font-weight: 600; }
.karaoke-badge.ready { background: color-mix(in srgb, var(--green) 20%, transparent); color: var(--green); }
.karaoke-badge.transcribing { background: color-mix(in srgb, var(--amber) 20%, transparent); color: var(--amber); }
.karaoke-badge.uploaded { background: color-mix(in srgb, var(--text-muted) 20%, transparent); color: var(--text-muted); }
.karaoke-badge.error { background: color-mix(in srgb, var(--accent) 20%, transparent); color: var(--accent); }
.karaoke-player { display: none; flex-direction: column; gap: 0.75rem; }
.karaoke-player.active { display: flex; }
.karaoke-lyrics { min-height: 120px; padding: 1rem; border-radius: 0.75rem; background: var(--surface); border: 1px solid var(--border-light); font-size: 1.4rem; line-height: 2; text-align: center; overflow-y: auto; max-height: 50vh; }
.karaoke-lyrics .word { display: inline-block; margin: 0 0.1em; transition: all 0.15s; opacity: 0.4; }
.karaoke-lyrics .word.active { opacity: 1; color: var(--accent); transform: scale(1.15); font-weight: 700; }
.karaoke-lyrics .word.past { opacity: 0.7; }
.karaoke-chords {
  border: 1px solid var(--border-light);
  border-radius: 0.65rem;
  padding: 0.55rem 0.65rem;
  background: color-mix(in srgb, var(--bg) 72%, transparent);
}
.karaoke-chords .row {
  display: flex;
  flex-wrap: wrap;
  gap: 0.35rem;
  margin-top: 0.4rem;
}
.karaoke-chord {
  border: 1px solid color-mix(in srgb, var(--accent) 55%, var(--border-light));
  border-radius: 999px;
  padding: 0.14rem 0.5rem;
  font-size: 0.72rem;
  font-family: var(--font-mono);
  color: var(--accent);
}
.karaoke-audio-controls { display: flex; align-items: center; gap: 0.5rem; }
.karaoke-audio-controls input[type="range"] { flex: 1; accent-color: var(--accent); }
.karaoke-fullscreen { position: fixed; inset: 0; z-index: 100; background: #000; display: none; flex-direction: column; align-items: center; justify-content: center; }
.karaoke-fullscreen.open { display: flex; }
.karaoke-fullscreen .karaoke-lyrics { font-size: 2.2rem; background: transparent; border: none; color: #fff; max-height: 80vh; }
.karaoke-fullscreen .close-fs { position: absolute; top: 1rem; right: 1rem; background: rgba(255,255,255,0.2); border: none; color: #fff; font-size: 1.5rem; width: 44px; height: 44px; border-radius: 50%; cursor: pointer; }
</style>
</head>
<body>
<div class="party-layer" aria-hidden="true">
  <div class="balloon b1" style="left:8%;animation-duration:16s;"></div>
  <div class="balloon b2" style="left:18%;animation-duration:20s;"></div>
  <div class="balloon b3" style="left:34%;animation-duration:18s;"></div>
  <div class="balloon b4" style="left:56%;animation-duration:17s;"></div>
  <div class="balloon b5" style="left:76%;animation-duration:21s;"></div>
  <div class="balloon b6" style="left:90%;animation-duration:19s;"></div>
  <div class="glitter" style="left:9%;top:14%;animation-delay:0.2s;"></div>
  <div class="glitter" style="left:28%;top:36%;animation-delay:1.1s;"></div>
  <div class="glitter" style="left:47%;top:21%;animation-delay:0.7s;"></div>
  <div class="glitter" style="left:67%;top:31%;animation-delay:1.6s;"></div>
  <div class="glitter" style="left:82%;top:18%;animation-delay:0.4s;"></div>
</div>
<div class="retro-bg" aria-hidden="true"></div>
<div class="retro-badge" data-retro-badge>RETRO BIRTHDAY MODE</div>

<div class="desktop-wrapper">
  <div class="desktop-story">
    <div class="gift-pack">
      <div class="gift-lid"></div>
      <div class="invite-card">
        <div class="eyebrow">BO√êSKORT ‚Ä¢ 19. J√öN√ç 2026 ‚Ä¢ REYKJAV√çK</div>
        <h1>Afm√¶li<br><span class="highlight">Omar 50</span></h1>
        <p>
          Gjafapakki me√∞ bo√∞i: opna√∞u pakkann og s√≠minn birtist me√∞ √∂llu flowi
          fyrir RSVP, quiz, selfie og karaoke.
        </p>
        <div class="gift-actions">
          <button class="btn primary" data-open-gift>Opna pakkann</button>
          <span style="font-family:var(--font-mono); font-size:0.68rem; padding:0.38rem 0.7rem; border:1px solid var(--border); border-radius:999px; color:var(--text-secondary);">INVITE + GIFT</span>
        </div>
      </div>
    </div>
  </div>

  <div class="phone-wrapper">
    <div class="phone-frame">
      <div class="phone-content" id="phoneContent"></div>
    </div>
  </div>

  <aside class="desktop-right" aria-label="Desktop Admin Panel">
    <div class="desktop-admin-head">
      <div class="section-label">DESKTOP ADMIN MODE</div>
      <div class="desktop-admin-title">Afm√¶lisstj√≥rnbor√∞</div>
      <div class="desktop-admin-sub">S√≠maparsari vinstra megin ‚Ä¢ stj√≥rn og yfirs√Ωn h√¶gra megin.</div>
    </div>
    <div class="desktop-admin-body">
      <div class="desktop-admin-row">
        <input type="password" data-desktop-admin-pass placeholder="Admin lykilor√∞ (valfrj√°lst)">
        <button class="btn primary" data-desktop-admin-action="login">Virkja admin</button>
      </div>
      <div class="desktop-admin-grid">
        <button class="btn" data-desktop-admin-action="host">Opna host sv√¶√∞i</button>
        <button class="btn" data-desktop-admin-action="photos">Opna myndavegg</button>
        <button class="btn" data-desktop-admin-action="refresh">Uppf√¶ra yfirlit</button>
        <button class="btn" data-desktop-admin-action="eventloop">R√¶sa event loop</button>
      </div>
      <div class="desktop-admin-grid">
        <div class="desktop-admin-kpi">
          <div class="k">J√° sv√∂r</div>
          <div class="v" data-yes-count>0</div>
        </div>
        <div class="desktop-admin-kpi">
          <div class="k">Nei sv√∂r</div>
          <div class="v" data-no-count>0</div>
        </div>
      </div>
      <div class="card" style="padding:0.75rem;">
        <div style="font-size:0.8rem; color:var(--text-secondary);" data-desktop-admin-status>
          Desktop admin mode tilb√∫i√∞. Virkja√∞u a√∞gang til a√∞ kalla √° verndu√∞ admin endpoint.
        </div>
      </div>
      <div class="card desktop-admin-log" style="padding:0.75rem;" data-desktop-admin-log>
        Live log b√≠√∞ur...
      </div>
    </div>
  </aside>
</div>

<div class="phone-content-mobile" id="appContent">
  <header class="safe-top" style="background: var(--bg-card); border-bottom: 1px solid var(--border); padding: 1rem 1.25rem;">
    <div class="section-label" data-i18n="mobile_hub">FARS√çMA VI√êBUR√êAMI√êJA</div>
    <h1 style="font-size: 1.5rem; font-weight: 700;" data-i18n="title">Afm√¶li mitt</h1>
    <p class="muted" style="margin-top:0.35rem; font-size:0.9rem;" data-i18n="subtitle">Part√Ωskipulag og bo√∞svarsferli fyrir 50 √°ra afm√¶li Omars.</p>
  </header>

  <section id="sec-home" class="hero animate-on-scroll">
    <div class="hero-wrap">
      <img class="hero-photo" src="/omar-birthday.jpg" alt="Birthday person photo" />
      <div class="hero-title-row">
        <div>
          <div style="font-weight:700; font-size:1.1rem;">Omar ver√∞ur 50</div>
          <div class="muted" style="font-size:0.82rem; margin-top:0.1rem;">19. j√∫n√≠ 2026 ‚Ä¢ Reykjav√≠k</div>
        </div>
        <div class="hero-age">50</div>
      </div>
    </div>
    <div class="hero-subline">Vissir √æ√∫? √Årgangur 1976, feril-sn√∫ningur 1999 og engin bakf√¶rsla √° part√Ωdegi.</div>
    <div class="widget-grid">
      <div class="widget-pill">
        <div class="label">Sta√∞reynd</div>
        <div class="value">6 kaflar</div>
      </div>
      <div class="widget-pill">
        <div class="label">Spurningar</div>
        <div class="value">100+</div>
      </div>
      <div class="widget-pill">
        <div class="label">Mode</div>
        <div class="value">Party Live</div>
      </div>
    </div>
    <div class="countdown-grid" data-countdown>
      <div class="countdown-unit">
        <div class="countdown-digits">
          <div class="countdown-digit" data-cd="d0">0</div>
          <div class="countdown-digit" data-cd="d1">0</div>
          <div class="countdown-digit" data-cd="d2">0</div>
        </div>
        <div class="countdown-label">dagar</div>
      </div>
      <div class="countdown-sep">:</div>
      <div class="countdown-unit">
        <div class="countdown-digits">
          <div class="countdown-digit" data-cd="h0">0</div>
          <div class="countdown-digit" data-cd="h1">0</div>
        </div>
        <div class="countdown-label">klst</div>
      </div>
      <div class="countdown-sep">:</div>
      <div class="countdown-unit">
        <div class="countdown-digits">
          <div class="countdown-digit" data-cd="m0">0</div>
          <div class="countdown-digit" data-cd="m1">0</div>
        </div>
        <div class="countdown-label">m√≠n</div>
      </div>
      <div class="countdown-sep">:</div>
      <div class="countdown-unit">
        <div class="countdown-digits">
          <div class="countdown-digit" data-cd="s0">0</div>
          <div class="countdown-digit" data-cd="s1">0</div>
        </div>
        <div class="countdown-label">sek</div>
      </div>
    </div>
    <div class="hero-actions">
      <button class="btn primary" data-jump="sec-rsvp">Svara bo√∞i</button>
      <button class="btn" data-jump="sec-quiz">Spurningaleikur</button>
      <button class="btn" data-jump="sec-photo">Myndaveggur</button>
      <button class="btn" data-jump="sec-selfie">Selfie-b√°s</button>
    </div>
  </section>

  <section class="zone">
    <div class="zone-shell">
      <div class="zone-head">
        <div class="section-label" data-i18n="party_sections">PART√ùHLUTAR</div>
        <div class="zone-title">A√∞koma og skipulag</div>
        <div class="zone-copy">Allar grunnuppl√Ωsingar √° einum sta√∞, s√≠√∞an d√Ωpri sv√¶√∞i ne√∞ar √° s√≠√∞unni.</div>
      </div>

    <div id="sec-rsvp" class="card stack-card expand-card animate-on-scroll open" onclick="this.classList.toggle('open')">
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
          <div style="font-weight: 600;" data-i18n="rsvp_title">Svara bo√∞i + innskr√°ning</div>
          <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.25rem;" data-i18n="rsvp_sub">Skr√°√∞u √æig inn me√∞ SMS e√∞a Google og svara√∞u bo√∞inu</div>
        </div>
        <span class="expand-indicator" style="color: var(--text-muted);">‚ñº</span>
      </div>
      <div class="expand-content">
        <div style="padding-top: 1rem; font-size: 0.9rem; color: var(--text-secondary); line-height: 1.6;">
          <div class="link-list" style="margin-top:0; margin-bottom:0.7rem;">
            <button class="btn" data-auth="sms" data-i18n="auth_sms">Halda √°fram me√∞ SMS</button>
            <button class="btn" data-auth="google" data-i18n="auth_google">Halda √°fram me√∞ Google</button>
          </div>
          <div data-auth-state class="muted" style="font-size:0.82rem;" data-i18n="not_signed">Ekki innskr√°√∞/ur.</div>
          <div class="link-list" style="margin-top:0.7rem;">
            <button class="btn success" data-rsvp="yes" data-i18n="yes_btn" disabled>J√°, √©g m√¶ti</button>
            <button class="btn danger" data-rsvp="no" data-i18n="no_btn" disabled>Nei, kemst ekki</button>
          </div>
          <div data-status class="muted" style="margin-top:0.6rem; font-size:0.82rem;" data-i18n="sign_in_first">Skr√°√∞u √æig inn fyrst til a√∞ svara bo√∞inu.</div>
        </div>
      </div>
    </div>

    <div id="sec-links" class="card stack-card expand-card animate-on-scroll" onclick="this.classList.toggle('open')">
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
          <div style="font-weight: 600;">Tenglar, lei√∞ir og verkefnalisti</div>
          <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.25rem;">Allt sem gestir √æurfa fyrir part√Ωdag</div>
        </div>
        <span class="expand-indicator" style="color: var(--text-muted);">‚ñº</span>
      </div>
      <div class="expand-content">
        <div style="padding-top: 1rem; font-size: 0.9rem; color: var(--text-secondary); line-height: 1.6;">
          <div class="link-list">
            <a class="btn primary" href="https://facebook.com/events" target="_blank" rel="noreferrer">Facebook-vi√∞bur√∞ur</a>
            <a class="btn" href="https://maps.google.com/?q=Reykjav%C3%ADk" target="_blank" rel="noreferrer">Lei√∞arl√Ωsing</a>
            <a class="btn" href="https://1976.eyjar.app" target="_blank" rel="noreferrer">√Årgangsm√≥t 1976</a>
          </div>
          <div style="margin-top:0.8rem;" class="muted">
            <div class="time-item"><b>18:00</b> Hur√∞ar opna + velkomin drykkur</div>
            <div class="time-item"><b>19:30</b> S√∂gubrot + sk√°lr√¶√∞u</div>
            <div class="time-item"><b>21:00</b> T√≥nlist + dansg√≥lf</div>
          </div>
          <ul class="todo-list">
            <li>Sta√∞festu n√°kv√¶mt sta√∞fang og b√≠last√¶√∞auppl√Ωsingar.</li>
            <li>Lj√∫ktu vi√∞ matar- og k√∂kumagn √∫t fr√° bo√∞ssv√∂rum.</li>
            <li>Birtu lokaskilabo√∞ til gesta 72 klst. fyrir vi√∞bur√∞.</li>
          </ul>
          <span class="pill">Fars√≠mi</span>
          <span class="pill">2076 st√≠ll</span>
        </div>
      </div>
    </div>

    <div class="card stack-card expand-card animate-on-scroll" onclick="this.classList.toggle('open')">
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
          <div style="font-weight: 600;">Flj√≥tlegar sta√∞reyndir</div>
          <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.25rem;">Smelltu til a√∞ sn√∫a</div>
        </div>
        <span class="expand-indicator" style="color: var(--text-muted);">‚ñº</span>
      </div>
      <div class="expand-content">
        <div style="padding-top: 1rem;">
          <div class="fact-rotator" data-fact-rotator>
            <div class="flip-inner">
              <div class="flip-face front">
                <div style="font-size:1.05rem; font-weight:700;" data-fact-title>1999</div>
                <small class="muted" data-fact-tag>Ferill tekur √≥v√¶nta beygju</small>
              </div>
              <div class="flip-face back" data-fact-detail>
                Eitt s√≠mtal fr√° T√∂lvun breytti √∂llu. R√°√∞ning af √∂rl√∂gum, ekki starfsmannag√°tt.
              </div>
            </div>
          </div>
          <div class="fact-meta" data-fact-meta>Smelltu √° spjaldi√∞ til a√∞ sj√° n√¶stu sta√∞reynd ‚Ä¢ 1/6</div>
          <div class="muted" style="font-size:0.74rem; margin-top:0.35rem;">Sn√Ωst √≠ gegnum sta√∞reyndir um afm√¶lisbarni√∞ vi√∞ hvern smell.</div>
          <div class="truth-grid">
            <div class="flip-card" onclick="this.classList.toggle('flipped')">
              <div class="flip-inner">
                <div class="flip-face front">
                  <small class="muted">Vissir √æ√∫?</small>
                  <div style="font-size:0.95rem; font-weight:700;">1999</div>
                  <div style="font-size:0.75rem;" class="muted">Ferill tekur beygju</div>
                </div>
                <div class="flip-face back">Sannleikur: Eitt s√≠mtal fr√° T√∂lvun setti n√Ωjan kafla √≠ gang.</div>
              </div>
            </div>
            <div class="flip-card" onclick="this.classList.toggle('flipped')">
              <div class="flip-inner">
                <div class="flip-face front">
                  <small class="muted">Vissir √æ√∫?</small>
                  <div style="font-size:0.95rem; font-weight:700;">Budapest</div>
                  <div style="font-size:0.75rem;" class="muted">Go√∞sagnahamur</div>
                </div>
                <div class="flip-face back">Sannleikur: 40 bj√≥rar, 4 dagar og samt minni fyrir allar s√∂gurnar.</div>
              </div>
            </div>
          </div>
          <div class="flip-grid" style="margin-top:0.55rem;">
            <div class="card" style="padding:0.55rem 0.7rem;">
              <div style="font-size:0.72rem; color:var(--text-muted);">Fj√∂ldi sta√∞reynda</div>
              <div style="font-weight:700; font-size:0.95rem;">6</div>
            </div>
            <div class="card" style="padding:0.55rem 0.7rem;">
              <div style="font-size:0.72rem; color:var(--text-muted);">Sni√∞</div>
              <div style="font-weight:700; font-size:0.95rem;">Sn√∫ningsspjald</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="zone-head">
      <div class="zone-title">Leikir og gjafasv√¶√∞i</div>
      <div class="zone-copy">Gagnvirk upplifun fyrir gesti me√∞ sannleikaspj√∂ldum, √≥skalista og quiz.</div>
    </div>

    <div id="sec-quiz" class="card stack-card expand-card animate-on-scroll" onclick="this.classList.toggle('open')">
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
          <div style="font-weight: 600;">√ìskalisti gjafa</div>
          <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.25rem;">Smelltu √° atri√∞i til a√∞ merkja sem teki√∞</div>
        </div>
        <span class="expand-indicator" style="color: var(--text-muted);">‚ñº</span>
      </div>
      <div class="expand-content">
        <div style="padding-top: 1rem; font-size: 0.9rem; color: var(--text-secondary); line-height: 1.6;">
          <div class="wishlist-board">
            <div class="wl-item" data-gift-item>
              <div class="wl-left">
                <span>üéß</span>
                <span class="wl-name">H√°g√¶√∞a heyrnart√≥l</span>
              </div>
              <span class="wl-badge">√ìteki√∞</span>
            </div>
            <div class="wl-item" data-gift-item>
              <div class="wl-left">
                <span>üìö</span>
                <span class="wl-name">B√≥k um t√¶kni e√∞a √¶vis√∂gu</span>
              </div>
              <span class="wl-badge">√ìteki√∞</span>
            </div>
            <div class="wl-item" data-gift-item>
              <div class="wl-left">
                <span>‚òï</span>
                <span class="wl-name">Vanda√∞ kaffi e√∞a kaffib√∫na√∞ur</span>
              </div>
              <span class="wl-badge">√ìteki√∞</span>
            </div>
            <div class="wl-item" data-gift-item>
              <div class="wl-left">
                <span>üéüÔ∏è</span>
                <span class="wl-name">Upplifunargj√∂f fyrir tvo</span>
              </div>
              <span class="wl-badge">√ìteki√∞</span>
            </div>
            <div class="wl-item" data-gift-item>
              <div class="wl-left">
                <span>üéÅ</span>
                <span class="wl-name">Gjafakort (frj√°ls upph√¶√∞)</span>
              </div>
              <span class="wl-badge">√ìteki√∞</span>
            </div>
          </div>
          <div class="muted" style="margin-top:0.55rem; font-size:0.78rem;">Merking er sta√∞bundin √≠ √æessu t√¶ki og hj√°lpar gestum a√∞ samr√¶ma val.</div>
        </div>
      </div>
    </div>

    <div class="card stack-card expand-card animate-on-scroll" onclick="this.classList.toggle('open')">
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
          <div style="font-weight: 600;">Omar 50 spurningaleikur</div>
          <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.25rem;">Allar spurningar s√≥ttar √∫r √∫tdr√¶gum spurningagrunni</div>
        </div>
        <span class="expand-indicator" style="color: var(--text-muted);">‚ñº</span>
      </div>
      <div class="expand-content">
        <div style="padding-top: 1rem; font-size: 0.9rem; color: var(--text-secondary); line-height: 1.6;">
          <div class="quiz-meta">
            <span data-quiz-progress>Spurning 0 / 0</span> ‚Ä¢ <span data-quiz-score>Stig 0</span>
          </div>
          <div data-quiz-question class="quiz-title">√ùttu √° ‚ÄûByrja leik‚Äú til a√∞ hefja.</div>
          <div data-quiz-options></div>
          <div data-quiz-result class="muted" style="margin-top:0.45rem; min-height: 1.6rem;"></div>
          <div class="link-list" style="margin-top:0.6rem;">
            <button class="btn primary" data-quiz-action="start">Byrja leik</button>
            <button class="btn" data-quiz-action="next" disabled>N√¶sta spurning</button>
          </div>
          <div class="link-list" style="margin-top:0.6rem;">
            <button class="btn" data-quiz-admin="login">Opna stj√≥rnandaa√∞gang</button>
            <button class="btn" data-quiz-admin="add" disabled>B√¶ta vi√∞ spurningu</button>
            <button class="btn danger" data-quiz-admin="delete" disabled>Ey√∞a spurningu</button>
          </div>
        </div>
      </div>
    </div>

    <div class="zone-head">
      <div class="zone-title">Mi√∞lun og h√Ωsing</div>
      <div class="zone-copy">Sl√≥√∞, myllumerki, myndaveggur og skipulagst√≥l fyrir √æ√°tttakendur.</div>
    </div>

    <div id="sec-hosting" class="card stack-card expand-card animate-on-scroll" onclick="this.classList.toggle('open')">
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
          <div style="font-weight: 600;">H√Ωsisl√≥√∞ + myllumerki</div>
          <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.25rem;">`mybirthday.myx.is/omars50` og myllumerkjami√∞u√∞ lei√∞aval.</div>
        </div>
        <span class="expand-indicator" style="color: var(--text-muted);">‚ñº</span>
      </div>
      <div class="expand-content">
        <div style="padding-top: 1rem;">
          <div class="muted">N√∫verandi sl√≥√∞: <b data-current-slug>omars50</b></div>
          <div class="muted" style="margin-top:0.2rem;">Instagram myllumerki: <a data-hashtag-link href="#" target="_blank" class="btn" style="padding:0.25rem 0.45rem;">#omars50</a></div>
          <div class="link-list" style="margin-top:0.6rem;">
            <button class="btn" data-hosting-action="signup">B√∫a til n√Ωja h√Ωsta part√Ωs√≠√∞u</button>
          </div>
        </div>
      </div>
    </div>

    <div id="sec-photo" class="card stack-card expand-card animate-on-scroll" onclick="this.classList.toggle('open')">
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
          <div style="font-weight: 600;">Myndaveggur</div>
          <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.25rem;">Instagram myllumerkjaveggur + myndir valdar af gestgjafa.</div>
        </div>
        <span class="expand-indicator" style="color: var(--text-muted);">‚ñº</span>
      </div>
      <div class="expand-content">
        <div style="padding-top: 1rem;">
          <div class="link-list" style="margin-top:0;">
            <a class="btn primary" data-instagram-tag target="_blank" rel="noreferrer">Opna Instagram merki</a>
            <button class="btn" data-photo-action="add" disabled>B√¶ta vi√∞ mynd (gestgjafi)</button>
          </div>
          <div data-photo-status class="muted" style="margin-top:0.5rem;">Hle√∞ myndavegg...</div>
          <div class="photo-grid" data-photo-grid></div>
        </div>
      </div>
    </div>

    <div id="sec-planner" class="card stack-card expand-card animate-on-scroll" onclick="this.classList.toggle('open')">
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
          <div style="font-weight: 600;">Part√Ωskipulag / √≥v√¶nt ums√≥kn</div>
          <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.25rem;">Gestgjafi getur b√¶tt vi√∞ skipulagi og a√∞rir geta s√≥tt um sem √≥v√¶nt a√∞sto√∞.</div>
        </div>
        <span class="expand-indicator" style="color: var(--text-muted);">‚ñº</span>
      </div>
      <div class="expand-content">
        <div style="padding-top: 1rem;">
          <div class="planner-grid">
            <select data-planner-type>
              <option value="host_add">Gestgjafi b√¶tir vi√∞ skipulagi</option>
              <option value="surprise_help">√ìv√¶nt a√∞sto√∞ fyrir gest</option>
            </select>
            <input data-planner-name type="text" placeholder="Nafn ums√¶kjanda" />
            <input data-planner-contact type="text" placeholder="Netfang e√∞a s√≠mi" />
            <input data-planner-for-guest type="text" placeholder="Fyrir hva√∞a gest (valfrj√°lst)" />
            <textarea data-planner-note placeholder="L√Ωsing √° a√∞sto√∞ e√∞a skipulagshugmynd"></textarea>
            <button class="btn primary" data-planner-submit>Senda ums√≥kn</button>
          </div>
          <div class="muted" data-planner-status style="margin-top:0.55rem; font-size:0.8rem;">Engin ums√≥kn send enn.</div>
        </div>
      </div>
    </div>

    <div class="zone-head">
      <div class="zone-title">Gestgjafastj√≥rnun</div>
      <div class="zone-copy">Loka√∞ sv√¶√∞i fyrir yfirs√Ωn, √æemu og r√¶singu √° event loop.</div>
    </div>

    <div id="sec-host" class="card stack-card expand-card animate-on-scroll" onclick="this.classList.toggle('open')">
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
          <div style="font-weight: 600;">Stj√≥rnbor√∞ gestgjafa</div>
          <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.25rem;">Yfirlit gesta, greining spurningaleiks og n√Ωleg sv√∂r.</div>
        </div>
        <span class="expand-indicator" style="color: var(--text-muted);">‚ñº</span>
      </div>
      <div class="expand-content">
        <div style="padding-top: 1rem;">
          <div class="link-list" style="margin-top:0;">
            <button class="btn" data-admin-action="login">Innskr√°ning gestgjafa</button>
            <button class="btn primary" data-admin-action="refresh" disabled>Uppf√¶ra yfirlit</button>
            <button class="btn primary" data-event-loop-action="start">Byrja mitt eigi√∞ part√Ωforrit</button>
          </div>
          <div style="margin-top:0.6rem;" class="muted">√ötlit forrits</div>
          <div style="margin-top:0.35rem;" data-theme-picker>
            <span class="theme-chip active" data-theme-select="bond">Bond</span>
            <span class="theme-chip" data-theme-select="deathBecomesHer">Death Becomes Her</span>
            <span class="theme-chip" data-theme-select="pinkPanther">Pink Panther</span>
            <span class="theme-chip" data-theme-select="retro80s">80s Retro</span>
          </div>
          <div data-admin-status class="muted" style="margin-top:0.5rem;">Gestgjafahamur er l√¶stur.</div>
          <div data-event-loop-status class="muted" style="margin-top:0.45rem; font-size:0.82rem;">Gestir geta kl√≥na√∞ vi√∞bur√∞inn yfir √≠ eigi√∞ forrit.</div>
          <div data-admin-overview class="muted" style="margin-top:0.7rem; font-size:0.86rem;"></div>
        </div>
      </div>
    </div>
    </div>
  </section>

  <section class="zone-metrics">
    <div class="kpi">
      <div class="kpi-label">Vi√∞bur√∞ardagur</div>
      <div class="kpi-value" style="color: var(--accent);">19 JUN</div>
    </div>
    <div class="kpi">
      <div class="kpi-label">Sta√∞setning</div>
      <div class="kpi-value" style="color: var(--green);">Reykjav√≠k</div>
    </div>
    <div class="kpi">
      <div class="kpi-label">M√¶tir</div>
      <div class="kpi-value" style="color: var(--amber);" data-yes-count>0</div>
    </div>
    <div class="kpi">
      <div class="kpi-label">M√¶tir ekki</div>
      <div class="kpi-value" style="color: var(--purple);" data-no-count>0</div>
    </div>
  </section>

  <!-- MySelfie Section -->
  <section id="sec-selfie" class="zone">
    <div class="zone-head">
      <div class="zone-title">Selfie Studio</div>
      <div class="zone-copy">Skj√≥tt capture flow me√∞ gallery, caption og ni√∞urhali.</div>
    </div>
    <div class="card stack-card">
      <div style="font-weight: 600; margin-bottom: 0.5rem;">Selfie-b√°s</div>
      <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.75rem;">Taktu selfie me√∞ gestum ‚Äî √°√∞ur og eftir veisluna!</div>
      <div class="selfie-camera" data-selfie-camera>
        <video data-selfie-video autoplay playsinline muted></video>
        <canvas data-selfie-canvas></canvas>
        <div class="selfie-countdown" data-selfie-countdown></div>
      </div>
      <div class="selfie-controls">
        <button class="btn" data-selfie-action="flip">Sn√∫a</button>
        <button class="btn primary" data-selfie-action="capture">Taktu mynd</button>
      </div>
      <div style="margin-top: 0.5rem; display: flex; gap: 0.4rem;">
        <input type="text" data-selfie-name placeholder="Nafn √æitt" style="flex: 1; padding: 0.45rem; border: 1px solid var(--border-light); border-radius: 0.5rem; background: var(--surface); color: var(--text-primary); font-size: 0.85rem;">
        <input type="text" data-selfie-caption placeholder="Texti (valfrj√°lst)" style="flex: 1; padding: 0.45rem; border: 1px solid var(--border-light); border-radius: 0.5rem; background: var(--surface); color: var(--text-primary); font-size: 0.85rem;">
      </div>
      <div data-selfie-status class="muted" style="margin-top: 0.4rem; font-size: 0.82rem;"></div>
      <div class="selfie-gallery" data-selfie-gallery></div>
    </div>
    <div class="selfie-lightbox" data-selfie-lightbox>
      <button class="close-lb" data-selfie-lightbox-close>&times;</button>
      <img data-selfie-lightbox-img src="" alt="Selfie">
      <div class="caption" data-selfie-lightbox-caption></div>
      <a class="btn" style="margin-top: 0.5rem; color: #fff; text-decoration: none;" data-selfie-lightbox-download download="selfie.jpg">S√¶kja mynd</a>
    </div>
  </section>

  <!-- MyKaraoke Section -->
  <section id="sec-karaoke" class="zone">
    <div class="zone-head">
      <div class="zone-title">Karaoke Stage</div>
      <div class="zone-copy">Upload, texta-umritun, sync texti og fullscreen hamur.</div>
    </div>
    <div class="card stack-card">
      <div style="font-weight: 600; margin-bottom: 0.5rem;">Karaoke</div>
      <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.75rem;">Hladdu upp lagi, gervigreindin umritar textann og √æ√∫ syngur karaoke!</div>
      <div data-karaoke-view="upload">
        <div class="karaoke-upload">
          <input type="text" data-karaoke-title placeholder="Heiti lags">
          <input type="text" data-karaoke-artist placeholder="Flytjandi (valfrj√°lst)">
          <input type="text" data-karaoke-added-by placeholder="Nafn √æitt">
          <label class="btn" style="text-align: center; cursor: pointer;">
            Veldu hlj√≥√∞skr√° (mp3, wav, ogg)
            <input type="file" data-karaoke-file accept="audio/*" style="display: none;">
          </label>
          <textarea data-karaoke-manual-lyrics placeholder="E√∞a l√≠mdu lagatexta h√©r (valfrj√°lst)" rows="3" style="resize: vertical;"></textarea>
          <button class="btn primary" data-karaoke-action="upload" disabled>Hla√∞a upp</button>
        </div>
        <div data-karaoke-status class="muted" style="margin-top: 0.4rem; font-size: 0.82rem;"></div>
        <div class="karaoke-song-list" data-karaoke-song-list></div>
      </div>
      <div class="karaoke-player" data-karaoke-view="player">
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <div>
            <div style="font-weight: 600;" data-karaoke-now-title></div>
            <div style="font-size: 0.8rem; color: var(--text-secondary);" data-karaoke-now-artist></div>
          </div>
          <button class="btn" data-karaoke-action="back-to-list" style="font-size: 0.8rem;">Til baka</button>
        </div>
        <div class="karaoke-lyrics" data-karaoke-lyrics></div>
        <div class="karaoke-chords" data-karaoke-chords></div>
        <div class="karaoke-audio-controls">
          <button class="btn" data-karaoke-action="play" style="min-width: 44px;">&#9654;</button>
          <input type="range" data-karaoke-seek min="0" max="100" value="0">
          <span data-karaoke-time style="font-size: 0.78rem; min-width: 3em;">0:00</span>
          <button class="btn" data-karaoke-action="fullscreen" style="min-width: 44px;">&#x26F6;</button>
        </div>
        <audio data-karaoke-audio preload="auto"></audio>
      </div>
    </div>
    <div class="karaoke-fullscreen" data-karaoke-fullscreen>
      <button class="close-fs" data-karaoke-fullscreen-close>&times;</button>
      <div class="karaoke-lyrics" data-karaoke-fs-lyrics></div>
      <div class="karaoke-chords" data-karaoke-fs-chords style="width:min(90vw,900px); margin-top:0.75rem;"></div>
      <div class="karaoke-audio-controls" style="position: absolute; bottom: 2rem; width: 80%;">
        <button class="btn" data-karaoke-fs-play style="min-width: 44px; color: #fff;">&#9654;</button>
        <input type="range" data-karaoke-fs-seek min="0" max="100" value="0">
        <span data-karaoke-fs-time style="font-size: 0.78rem; color: #fff; min-width: 3em;">0:00</span>
      </div>
    </div>
  </section>

  <footer class="safe-bottom" style="text-align: center; padding: 2rem 1rem; color: var(--text-muted); font-size: 0.8rem;">
    Afm√¶li mitt ‚Ä¢ Omar 50 ‚Ä¢ 19. j√∫n√≠ 2026
  </footer>

  <div class="nav-feedback" data-nav-feedback>Vali√∞: Heim</div>
  <nav class="bottom-nav" role="navigation" aria-label="A√∞alvalmynd">
    <button class="nav-chip active" data-jump="sec-home" data-i18n="nav_home" aria-current="page">
      <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 11.5 12 4l9 7.5"/><path d="M5 10.5V20h14v-9.5"/><path d="M10 20v-5h4v5"/></svg>
      <span class="label">Heim</span>
    </button>
    <button class="nav-chip" data-jump="sec-rsvp" data-i18n="nav_rsvp">
      <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="5" width="18" height="14" rx="2"/><path d="m3 7 9 6 9-6"/></svg>
      <span class="label">RSVP</span>
    </button>
    <button class="nav-chip" data-jump="sec-links" data-i18n="nav_plan">
      <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 14 21 3"/><path d="M21 8V3h-5"/><path d="M3 6h6"/><path d="M3 12h8"/><path d="M3 18h10"/></svg>
      <span class="label">Dagskr√°</span>
    </button>
    <button class="nav-chip" data-jump="sec-quiz" data-i18n="nav_quiz">
      <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="9"/><path d="M9.5 9a2.5 2.5 0 1 1 4.5 1.5c-.7.9-1.5 1.4-1.5 2.5"/><circle cx="12" cy="17" r="1"/></svg>
      <span class="label">Spurningar</span>
    </button>
    <button class="nav-chip" data-jump="sec-photo" data-i18n="nav_photos">
      <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="5" width="18" height="14" rx="2"/><circle cx="9" cy="10" r="1.5"/><path d="m21 16-5-4-4 3-2-1.5L3 19"/></svg>
      <span class="label">Myndir</span>
    </button>
    <button class="nav-chip" data-jump="sec-selfie" data-i18n="nav_selfie">
      <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="4" width="20" height="16" rx="2"/><circle cx="12" cy="12" r="3.5"/><path d="M2 8h2"/><path d="M20 8h2"/></svg>
      <span class="label">Selfie</span>
    </button>
    <button class="nav-chip" data-jump="sec-karaoke" data-i18n="nav_karaoke">
      <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 1v11"/><circle cx="12" cy="12" r="3"/><path d="M8 21h8"/><path d="M12 17v4"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/></svg>
      <span class="label">Karaoke</span>
    </button>
    <button class="nav-chip" data-jump="sec-host" data-i18n="nav_host">
      <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="8" r="3.5"/><path d="M4 20c1.5-3 4.2-4.5 8-4.5s6.5 1.5 8 4.5"/></svg>
      <span class="label">Gestgjafi</span>
    </button>
  </nav>
</div>

<script>
function initInteractions(root) {
  const state = { method: null, contact: null, name: null };
  const quizState = { questions: [], index: -1, score: 0, active: false, adminPassword: null };

  const authState = root.querySelector('[data-auth-state]');
  const statusEl = root.querySelector('[data-status]');
  const yesBtn = root.querySelector('[data-rsvp="yes"]');
  const noBtn = root.querySelector('[data-rsvp="no"]');
  const quizProgress = root.querySelector('[data-quiz-progress]');
  const quizScore = root.querySelector('[data-quiz-score]');
  const quizQuestion = root.querySelector('[data-quiz-question]');
  const quizOptions = root.querySelector('[data-quiz-options]');
  const quizResult = root.querySelector('[data-quiz-result]');
  const quizStartBtn = root.querySelector('[data-quiz-action="start"]');
  const quizNextBtn = root.querySelector('[data-quiz-action="next"]');
  const quizAdminLoginBtn = root.querySelector('[data-quiz-admin="login"]');
  const quizAdminAddBtn = root.querySelector('[data-quiz-admin="add"]');
  const quizAdminDeleteBtn = root.querySelector('[data-quiz-admin="delete"]');
  const adminStatus = root.querySelector('[data-admin-status]');
  const adminOverview = root.querySelector('[data-admin-overview]');
  const adminLoginBtn = root.querySelector('[data-admin-action="login"]');
  const adminRefreshBtn = root.querySelector('[data-admin-action="refresh"]');
  const eventLoopStartBtn = root.querySelector('[data-event-loop-action="start"]');
  const eventLoopStatus = root.querySelector('[data-event-loop-status]');
  const currentSlugLabel = root.querySelector('[data-current-slug]');
  const hashtagLink = root.querySelector('[data-hashtag-link]');
  const instagramTagLink = root.querySelector('[data-instagram-tag]');
  const hostingSignupBtn = root.querySelector('[data-hosting-action="signup"]');
  const photoStatus = root.querySelector('[data-photo-status]');
  const photoGrid = root.querySelector('[data-photo-grid]');
  const photoAddBtn = root.querySelector('[data-photo-action="add"]');
  const plannerType = root.querySelector('[data-planner-type]');
  const plannerName = root.querySelector('[data-planner-name]');
  const plannerContact = root.querySelector('[data-planner-contact]');
  const plannerForGuest = root.querySelector('[data-planner-for-guest]');
  const plannerNote = root.querySelector('[data-planner-note]');
  const plannerSubmit = root.querySelector('[data-planner-submit]');
  const plannerStatus = root.querySelector('[data-planner-status]');
  const navFeedback = root.querySelector('[data-nav-feedback]');
  // Selfie elements
  const selfieVideo = root.querySelector('[data-selfie-video]');
  const selfieCanvas = root.querySelector('[data-selfie-canvas]');
  const selfieCountdown = root.querySelector('[data-selfie-countdown]');
  const selfieCaptureBtn = root.querySelector('[data-selfie-action="capture"]');
  const selfieFlipBtn = root.querySelector('[data-selfie-action="flip"]');
  const selfieName = root.querySelector('[data-selfie-name]');
  const selfieCaption = root.querySelector('[data-selfie-caption]');
  const selfieStatus = root.querySelector('[data-selfie-status]');
  const selfieGallery = root.querySelector('[data-selfie-gallery]');
  const selfieLightbox = root.querySelector('[data-selfie-lightbox]');
  const selfieLbImg = root.querySelector('[data-selfie-lightbox-img]');
  const selfieLbCaption = root.querySelector('[data-selfie-lightbox-caption]');
  const selfieLbDownload = root.querySelector('[data-selfie-lightbox-download]');
  const selfieLbClose = root.querySelector('[data-selfie-lightbox-close]');
  // Karaoke elements
  const karaokeTitle = root.querySelector('[data-karaoke-title]');
  const karaokeArtist = root.querySelector('[data-karaoke-artist]');
  const karaokeAddedBy = root.querySelector('[data-karaoke-added-by]');
  const karaokeFile = root.querySelector('[data-karaoke-file]');
  const karaokeManualLyrics = root.querySelector('[data-karaoke-manual-lyrics]');
  const karaokeUploadBtn = root.querySelector('[data-karaoke-action="upload"]');
  const karaokeStatus = root.querySelector('[data-karaoke-status]');
  const karaokeSongList = root.querySelector('[data-karaoke-song-list]');
  const karaokeUploadView = root.querySelector('[data-karaoke-view="upload"]');
  const karaokePlayerView = root.querySelector('[data-karaoke-view="player"]');
  const karaokeLyrics = root.querySelector('[data-karaoke-lyrics]');
  const karaokeAudio = root.querySelector('[data-karaoke-audio]');
  const karaokeNowTitle = root.querySelector('[data-karaoke-now-title]');
  const karaokeNowArtist = root.querySelector('[data-karaoke-now-artist]');
  const karaokePlayBtn = root.querySelector('[data-karaoke-action="play"]');
  const karaokeSeek = root.querySelector('[data-karaoke-seek]');
  const karaokeTime = root.querySelector('[data-karaoke-time]');
  const karaokeBackBtn = root.querySelector('[data-karaoke-action="back-to-list"]');
  const karaokeFullscreenBtn = root.querySelector('[data-karaoke-action="fullscreen"]');
  const karaokeFullscreen = root.querySelector('[data-karaoke-fullscreen]');
  const karaokeFsClose = root.querySelector('[data-karaoke-fullscreen-close]');
  const karaokeFsLyrics = root.querySelector('[data-karaoke-fs-lyrics]');
  const karaokeChords = root.querySelector('[data-karaoke-chords]');
  const karaokeFsChords = root.querySelector('[data-karaoke-fs-chords]');
  const karaokeFsPlay = root.querySelector('[data-karaoke-fs-play]');
  const karaokeFsSeek = root.querySelector('[data-karaoke-fs-seek]');
  const karaokeFsTime = root.querySelector('[data-karaoke-fs-time]');
  const currentSlug = (window.__APP_SLUG__ || location.pathname.split('/').filter(Boolean)[0] || 'omars50').toLowerCase();
  const giftStorageKey = `myx-gift-wishlist:${currentSlug}`;

  root.querySelectorAll('button, a.btn').forEach((el) => {
    el.addEventListener('click', (ev) => ev.stopPropagation());
  });
  const birthdayFacts = [
    {
      title: '1976',
      tag: 'Byrjunin',
      detail: 'Afm√¶lisbarni√∞ f√¶ddist og √æessi √∫tg√°fa af s√∂gu hans h√≥fst.'
    },
    {
      title: '1999',
      tag: 'Ferill tekur √≥v√¶nta beygju',
      detail: 'Eitt s√≠mtal fr√° T√∂lvun breytti √∂llu. R√°√∞ning af √∂rl√∂gum, ekki starfsmannag√°tt.'
    },
    {
      title: '2017',
      tag: 'omar4.0 h√≥fst',
      detail: '√Årlegar uppf√¶rslur h√≥fust. F√≥lk getur l√≠ka sent √∫t breytingaskr√°r.'
    },
    {
      title: '2020+',
      tag: 'Kerfi √≠ framlei√∞slu',
      detail: 'Verkefni og sj√°lfvirkni sk√∂pu√∞u st√∂√∞ugan grunn fyrir n√¶sta kafla.'
    },
    {
      title: '2026',
      tag: 'v50.0 h√°t√≠√∞',
      detail: 'Engin bakf√¶rsla. Part√Ωherting er komin √≠ framlei√∞slu.'
    },
    {
      title: 'Budapest',
      tag: 'go√∞sagnahamur',
      detail: '40 bj√≥rar, 4 dagar og samt n√≥g minni fyrir √æetta part√Ω.'
    },
  ];
  root.querySelectorAll('[data-fact-rotator]').forEach((card) => {
    const titleEl = card.querySelector('[data-fact-title]');
    const tagEl = card.querySelector('[data-fact-tag]');
    const detailEl = card.querySelector('[data-fact-detail]');
    const metaEl = root.querySelector('[data-fact-meta]');
    let factIndex = 0;

    function renderFact(idx) {
      const fact = birthdayFacts[idx];
      if (!fact || !titleEl || !tagEl || !detailEl) return;
      titleEl.textContent = fact.title;
      tagEl.textContent = fact.tag;
      detailEl.textContent = fact.detail;
      if (metaEl) metaEl.textContent = `Smelltu √° spjaldi√∞ til a√∞ sj√° n√¶stu sta√∞reynd ‚Ä¢ ${idx + 1}/${birthdayFacts.length}`;
    }

    renderFact(factIndex);
    card.addEventListener('click', (ev) => {
      ev.stopPropagation();
      card.classList.add('flipped');
      setTimeout(() => {
        factIndex = (factIndex + 1) % birthdayFacts.length;
        renderFact(factIndex);
      }, 240);
      setTimeout(() => {
        card.classList.remove('flipped');
      }, 520);
    });
  });

  function loadGiftState() {
    try {
      const raw = localStorage.getItem(giftStorageKey);
      const parsed = raw ? JSON.parse(raw) : [];
      return Array.isArray(parsed) ? parsed.filter((x) => Number.isInteger(x)) : [];
    } catch {
      return [];
    }
  }

  function saveGiftState(indexes) {
    try {
      localStorage.setItem(giftStorageKey, JSON.stringify(indexes));
    } catch {
      // ignore storage failures
    }
  }

  const doneIndexes = new Set(loadGiftState());
  root.querySelectorAll('[data-gift-item]').forEach((item, idx) => {
    if (doneIndexes.has(idx)) {
      item.classList.add('done');
      const initialBadge = item.querySelector('.wl-badge');
      if (initialBadge) initialBadge.textContent = 'Teki√∞';
    }
    item.addEventListener('click', (ev) => {
      ev.stopPropagation();
      item.classList.toggle('done');
      const badge = item.querySelector('.wl-badge');
      if (badge) badge.textContent = item.classList.contains('done') ? 'Teki√∞' : '√ìteki√∞';
      const selected = [];
      root.querySelectorAll('[data-gift-item]').forEach((row, i) => {
        if (row.classList.contains('done')) selected.push(i);
      });
      saveGiftState(selected);
    });
  });
  root.querySelectorAll('[data-jump]').forEach((el) => {
    el.addEventListener('click', (ev) => {
      ev.stopPropagation();
      const id = el.getAttribute('data-jump');
      if (!id) return;
      const target = root.querySelector('#' + id);
      if (!target) return;

      root.querySelectorAll('[data-jump]').forEach((btn) => {
        btn.classList.toggle('active', btn === el);
        if (btn === el) btn.setAttribute('aria-current', 'page');
        else btn.removeAttribute('aria-current');
      });
      const label = el.querySelector('.label') ? el.querySelector('.label').textContent : el.textContent;
      if (navFeedback && label) navFeedback.textContent = 'Vali√∞: ' + label.trim();

      if (root.id === 'phoneContent') {
        root.scrollTo({ top: target.offsetTop - 10, behavior: 'smooth' });
      } else {
        target.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    });
  });

  function startDynamiteChaos() {
    if (window.__partyChaosStarted) return;
    window.__partyChaosStarted = true;
    const balloons = Array.from(document.querySelectorAll('.party-layer .balloon'));
    const chaosFeedback = root.querySelector('[data-nav-feedback]');
    const confettiColors = ['#f5d77a', '#2fb36d', '#e05252', '#f472b6', '#60a5fa', '#ffffff'];
    if (!balloons.length) return;

    function burstConfetti(x, y, amount) {
      for (let i = 0; i < amount; i++) {
        const piece = document.createElement('span');
        piece.className = 'confetti-piece';
        piece.style.left = x + 'px';
        piece.style.top = y + 'px';
        piece.style.background = confettiColors[i % confettiColors.length];
        piece.style.setProperty('--drift-x', ((Math.random() - 0.5) * 240).toFixed(1) + 'px');
        piece.style.setProperty('--drift-y', (140 + Math.random() * 380).toFixed(1) + 'px');
        piece.style.setProperty('--spin', ((Math.random() - 0.5) * 960).toFixed(0) + 'deg');
        piece.style.animationDuration = (1.3 + Math.random() * 1.4).toFixed(2) + 's';
        piece.style.opacity = (0.75 + Math.random() * 0.25).toFixed(2);
        document.body.appendChild(piece);
        setTimeout(() => piece.remove(), 2900);
      }
    }

    function triggerChaos() {
      const balloon = balloons[Math.floor(Math.random() * balloons.length)];
      if (!balloon) return;

      balloon.classList.add('dynamite');
      if (chaosFeedback) chaosFeedback.textContent = 'D√Ωnam√≠t-k√∫la virkju√∞...';

      setTimeout(() => {
        const rect = balloon.getBoundingClientRect();
        const x = rect.left + rect.width / 2;
        const y = rect.top + rect.height / 2;
        const burst = document.createElement('span');
        burst.className = 'balloon-burst';
        burst.style.left = x + 'px';
        burst.style.top = y + 'px';
        document.body.appendChild(burst);
        setTimeout(() => burst.remove(), 520);

        burstConfetti(x, y, 120 + Math.floor(Math.random() * 90));
        balloon.classList.add('pop');

        const candidates = Array.from(root.querySelectorAll('.card, .kpi, .hero, .nav-chip'))
          .filter((el) => !el.classList.contains('damage-glitch'));
        const victim = candidates[Math.floor(Math.random() * candidates.length)];
        if (victim) victim.classList.add('damage-glitch');
        if (chaosFeedback) chaosFeedback.textContent = 'BOOM! Sm√° bilun... vi√∞ger√∞ √≠ gangi.';

        setTimeout(() => {
          if (victim) victim.classList.remove('damage-glitch');
          balloon.classList.remove('pop', 'dynamite');
          if (chaosFeedback) chaosFeedback.textContent = 'Kerfi komi√∞ √≠ lag.';
        }, 2300);
      }, 1200 + Math.random() * 900);
    }

    (function scheduleNext() {
      const waitMs = 9000 + Math.random() * 14000;
      setTimeout(() => {
        triggerChaos();
        scheduleNext();
      }, waitMs);
    })();
  }
  startDynamiteChaos();

  function setupDesktopAdminPanel() {
    if (!(window.innerWidth > 768 && root.id === 'phoneContent')) return;
    const status = document.querySelector('[data-desktop-admin-status]');
    const passInput = document.querySelector('[data-desktop-admin-pass]');
    const loginBtn = document.querySelector('[data-desktop-admin-action="login"]');
    const hostBtn = document.querySelector('[data-desktop-admin-action="host"]');
    const photosBtn = document.querySelector('[data-desktop-admin-action="photos"]');
    const refreshBtn = document.querySelector('[data-desktop-admin-action="refresh"]');
    const eventLoopBtn = document.querySelector('[data-desktop-admin-action="eventloop"]');
    const logEl = document.querySelector('[data-desktop-admin-log]');

    function activateDesktopAdmin(pass) {
      if (pass) quizState.adminPassword = pass;
      if (!state.contact || !state.method) {
        state.method = 'desktop';
        state.contact = 'desktop-admin@myx.local';
        state.name = 'Desktop Admin';
      }
      if (quizAdminAddBtn) quizAdminAddBtn.disabled = false;
      if (quizAdminDeleteBtn) quizAdminDeleteBtn.disabled = false;
      if (adminRefreshBtn) adminRefreshBtn.disabled = false;
      if (adminStatus) adminStatus.textContent = 'Gestgjafahamur virkur (desktop mode).';
      if (status) status.textContent = pass
        ? 'Admin mode virkt me√∞ lykilor√∞i. Endpoint stj√≥rnun tilb√∫in.'
        : 'Admin mode virkt. Settu lykilor√∞ ef √æ√∫ vilt kalla √° verndu√∞ endpoint.';
    }

    async function refreshDesktopAdminLog() {
      if (!logEl) return;
      try {
        const statsRes = await fetch('/api/rsvp/stats');
        const stats = await statsRes.json();
        if (!statsRes.ok) throw new Error('stats');
        const now = new Date().toLocaleTimeString('is-IS', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
        let lines = [
          '<b>Live ' + now + '</b>',
          '<br>RSVP: ' + (stats.attendingYes ?? 0) + ' j√° ‚Ä¢ ' + (stats.attendingNo ?? 0) + ' nei',
        ];
        if (quizState.adminPassword) {
          const overviewRes = await fetch('/api/admin/overview?slug=' + encodeURIComponent(currentSlug), {
            headers: { 'x-admin-password': quizState.adminPassword }
          });
          const overview = await overviewRes.json();
          if (overviewRes.ok) {
            const recent = (overview.quiz?.recentAnswers || []).slice(0, 4).map((x) =>
              (x.playerName || 'Gestur') + ' Q' + x.questionId + ' ' + (x.correct ? '‚úÖ' : '‚ùå')
            );
            lines = lines.concat([
              '<br>Quiz sv√∂r: ' + (overview.quiz?.totalAnswers ?? 0),
              '<br>Planner: ' + (overview.planner?.total ?? 0),
              '<br>N√Ωlegt: ' + (recent.length ? recent.join(' ‚Ä¢ ') : 'ekkert enn'),
            ]);
          }
        } else {
          lines.push('<br><span class="muted">Settu admin lykilor√∞ til a√∞ sj√° dj√∫pari logs.</span>');
        }
        logEl.innerHTML = lines.join('');
      } catch {
        logEl.textContent = 'Live log villa. Reyni aftur...';
      }
    }

    activateDesktopAdmin('');
    refreshDesktopAdminLog();
    setInterval(refreshDesktopAdminLog, 15000);

    if (loginBtn) loginBtn.addEventListener('click', (ev) => {
      ev.stopPropagation();
      const pass = passInput && passInput.value ? passInput.value.trim() : '';
      activateDesktopAdmin(pass);
      if (pass) refreshAdminOverview();
      refreshDesktopAdminLog();
    });
    if (hostBtn) hostBtn.addEventListener('click', (ev) => {
      ev.stopPropagation();
      const btn = root.querySelector('[data-jump="sec-host"]');
      if (btn) btn.click();
    });
    if (photosBtn) photosBtn.addEventListener('click', (ev) => {
      ev.stopPropagation();
      const btn = root.querySelector('[data-jump="sec-photo"]');
      if (btn) btn.click();
    });
    if (refreshBtn) refreshBtn.addEventListener('click', (ev) => {
      ev.stopPropagation();
      refreshAdminOverview();
      refreshDesktopAdminLog();
    });
    if (eventLoopBtn) eventLoopBtn.addEventListener('click', (ev) => {
      ev.stopPropagation();
      startMyEventLoop();
    });
  }
  setupDesktopAdminPanel();

  if (currentSlugLabel) currentSlugLabel.textContent = currentSlug;

  function setSignedIn(method, contact, name) {
    state.method = method;
    state.contact = contact;
    state.name = name;
    authState.textContent = 'Innskr√°√∞/ur me√∞ ' + method.toUpperCase() + ' sem ' + contact;
    yesBtn.disabled = false;
    noBtn.disabled = false;
    statusEl.textContent = 'Tilb√∫i√∞ a√∞ svara bo√∞i.';
  }

  function ownerIdFromState() {
    if (!state.contact) return '';
    const normalized = String(state.contact).trim().toLowerCase().replace(/[^a-z0-9@._-]+/g, '-');
    return normalized.slice(0, 64);
  }

  async function refreshStats() {
    try {
      const res = await fetch('/api/rsvp/stats');
      const data = await res.json();
      document.querySelectorAll('[data-yes-count]').forEach((el) => { el.textContent = String(data.attendingYes ?? 0); });
      document.querySelectorAll('[data-no-count]').forEach((el) => { el.textContent = String(data.attendingNo ?? 0); });
    } catch {
      document.querySelectorAll('[data-yes-count]').forEach((el) => { el.textContent = '?'; });
      document.querySelectorAll('[data-no-count]').forEach((el) => { el.textContent = '?'; });
    }
  }

  async function submitRsvp(attending) {
    if (!state.contact || !state.method) {
      statusEl.textContent = 'Skr√°√∞u √æig inn fyrst.';
      return;
    }

    const partySize = Number(prompt('Hversu margir eru √≠ h√≥pnum √æ√≠num me√∞ √æ√©r?', '1') || '1');
    const plusOne = prompt('Nafn aukagests (valfrj√°lst):', '') || '';
    const dietary = prompt('Matar√≥skir (valfrj√°lst):', '') || '';
    const note = prompt('Skilabo√∞ til Omars (valfrj√°lst):', '') || '';

    statusEl.textContent = 'Sendi bo√∞ssvar...';
    try {
      const res = await fetch('/api/rsvp', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          attending,
          method: state.method,
          contact: state.contact,
          name: state.name || 'Gestur',
          partySize: Number.isFinite(partySize) ? partySize : 1,
          plusOne,
          dietary,
          note,
        })
      });
      const data = await res.json();
      if (!res.ok) throw new Error(data.error || 'Mist√≥kst a√∞ vista bo√∞ssvar');
      statusEl.textContent = attending
        ? 'Bo√∞ssvar vista√∞: m√¶tir.'
        : 'Bo√∞ssvar vista√∞: kemst ekki.';
      await refreshStats();
    } catch (err) {
      statusEl.textContent = 'Villa: ' + err.message;
    }
  }

  function renderQuizQuestion() {
    const q = quizState.questions[quizState.index];
    if (!q) return;
    quizProgress.textContent = 'Spurning ' + (quizState.index + 1) + ' / ' + quizState.questions.length;
    quizScore.textContent = 'Stig ' + quizState.score;
    quizQuestion.textContent = q.cat + ' (' + q.yr + '): ' + q.q;
    quizResult.textContent = '';
    quizOptions.innerHTML = '';
    q.opts.forEach((opt, idx) => {
      const btn = document.createElement('button');
      btn.className = 'btn quiz-option';
      btn.type = 'button';
      btn.textContent = String.fromCharCode(65 + idx) + '. ' + opt;
      btn.addEventListener('click', async (ev) => {
        ev.stopPropagation();
        if (!quizState.active) return;
        quizState.active = false;
        const res = await fetch('/api/quiz/answer', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            id: q.id,
            choice: idx,
            playerId: state.contact || 'nafnlaus',
            playerName: state.name || 'Gestur',
          })
        });
        const data = await res.json();
        if (data.correct) {
          quizState.score += 1;
          quizResult.textContent = 'R√©tt svar! ' + data.explanation;
        } else {
          quizResult.textContent = 'Rangt svar. ' + data.explanation;
        }
        quizScore.textContent = 'Stig ' + quizState.score;
        quizNextBtn.disabled = false;
        Array.from(quizOptions.querySelectorAll('button')).forEach((b) => { b.disabled = true; });
      });
      quizOptions.appendChild(btn);
    });
  }

  async function startQuiz(ev) {
    ev.stopPropagation();
    quizStartBtn.disabled = true;
    quizResult.textContent = 'Hle√∞ inn spurningum...';
    try {
      const res = await fetch('/api/quiz/questions');
      const data = await res.json();
      quizState.questions = data.questions || [];
      quizState.index = 0;
      quizState.score = 0;
      quizState.active = true;
      quizNextBtn.disabled = true;
      renderQuizQuestion();
    } catch {
      quizResult.textContent = 'Gat ekki hla√∞i√∞ spurningaleik.';
    } finally {
      quizStartBtn.disabled = false;
    }
  }

  function nextQuizQuestion(ev) {
    ev.stopPropagation();
    if (!quizState.questions.length) return;
    quizState.index += 1;
    if (quizState.index >= quizState.questions.length) {
      quizQuestion.textContent = 'Leik loki√∞.';
      quizOptions.innerHTML = '';
      quizResult.textContent = 'Lokastig: ' + quizState.score + ' / ' + quizState.questions.length;
      quizProgress.textContent = 'Spurning ' + quizState.questions.length + ' / ' + quizState.questions.length;
      quizNextBtn.disabled = true;
      quizState.active = false;
      return;
    }
    quizState.active = true;
    quizNextBtn.disabled = true;
    renderQuizQuestion();
  }

  function adminHeaders() {
    return {
      'Content-Type': 'application/json',
      'x-admin-password': quizState.adminPassword || ''
    };
  }

  function adminLogin(ev) {
    ev.stopPropagation();
    const pass = prompt('Lykilor√∞ stj√≥rnanda:');
    if (!pass) return;
    quizState.adminPassword = pass;
    quizAdminAddBtn.disabled = false;
    quizAdminDeleteBtn.disabled = false;
    if (adminRefreshBtn) adminRefreshBtn.disabled = false;
    quizResult.textContent = 'Stj√≥rnandahamur virkur.';
    if (adminStatus) adminStatus.textContent = 'Gestgjafahamur virkur.';
  }

  async function refreshAdminOverview(ev) {
    if (ev) ev.stopPropagation();
    if (!quizState.adminPassword || !adminOverview || !adminStatus) return;
    adminStatus.textContent = 'Hle√∞ yfirliti gestgjafa...';
    try {
      const res = await fetch('/api/admin/overview', { headers: { 'x-admin-password': quizState.adminPassword } });
      const data = await res.json();
      if (!res.ok) throw new Error(data.error || 'Mist√≥kst a√∞ hla√∞a yfirlit');
      const attendees = data.attendees || {};
      const quiz = data.quiz || {};
      const planner = data.planner || {};
      const recent = (quiz.recentAnswers || []).slice(0, 8).map((r) =>
        (r.playerName || 'Gestur') + ' -> Q' + r.questionId + ' ' + (r.correct ? '‚úÖ' : '‚ùå')
      );
      adminOverview.innerHTML = [
        '<b>Gestir:</b> ' + (attendees.attending ?? 0) + ' j√°, ' + (attendees.notAttending ?? 0) + ' nei, heildarfj√∂ldi: ' + (attendees.totalHeads ?? 0),
        '<br><b>Part√Ωsta√∞a:</b> ' + (attendees.humor || 'Dansg√≥lf √≥sta√∞fest.'),
        '<br><b>Spurningaleikur:</b> ' + (quiz.totalAnswers ?? 0) + ' sv√∂r, n√°kv√¶mni ' + Math.round((quiz.overallAccuracy || 0) * 100) + '%',
        '<br><b>Planner ums√≥knir:</b> ' + (planner.total ?? 0) + ' samtals (' + (planner.hostAdds ?? 0) + ' fr√° gestgjafa, ' + (planner.surpriseHelps ?? 0) + ' surprise)',
        '<br><b>Erfi√∞asta spurning:</b> ' + (quiz.hardestQuestionId ?? 'ekki tilt√¶kt'),
        '<br><b>N√Ωleg sv√∂r:</b> ' + (recent.length ? recent.join(' ‚Ä¢ ') : 'Engin enn')
      ].join('');
      adminStatus.textContent = 'Yfirlit gestgjafa uppf√¶rt.';
    } catch (err) {
      adminStatus.textContent = 'Mist√≥kst a√∞ s√¶kja yfirlit gestgjafa: ' + err.message;
    }
  }

  function updateHashtagLinks(tag) {
    const clean = (tag || currentSlug).replace(/^#/, '');
    const url = 'https://www.instagram.com/explore/tags/' + encodeURIComponent(clean) + '/';
    if (hashtagLink) {
      hashtagLink.textContent = '#' + clean;
      hashtagLink.setAttribute('href', url);
    }
    if (instagramTagLink) instagramTagLink.setAttribute('href', url);
  }

  async function loadPhotoWall() {
    if (!photoGrid || !photoStatus) return;
    photoStatus.textContent = 'Hle√∞ inn myndavegg...';
    try {
      const res = await fetch('/api/photowall?slug=' + encodeURIComponent(currentSlug));
      const data = await res.json();
      if (!res.ok) throw new Error(data.error || 'Mist√≥kst a√∞ hla√∞a myndavegg');
      updateHashtagLinks(data.hashtag || currentSlug);
      const items = data.items || [];
      if (!items.length) {
        photoGrid.innerHTML = '';
        photoStatus.textContent = 'Engar myndir enn. B√¶ttu vi√∞ √≠ gestgjafaham e√∞a nota√∞u #' + (data.hashtag || currentSlug);
        return;
      }
      photoStatus.textContent = items.length + ' myndir s√≥ttar.';
      photoGrid.innerHTML = items.slice(0, 24).map((item) => (
        '<div class="photo-item">' +
          '<img src="' + item.imageUrl + '" alt="Mynd √° myndavegg" loading="lazy" />' +
          '<div>' + (item.caption || 'Part√Ωminning') + '</div>' +
        '</div>'
      )).join('');
    } catch (err) {
      photoStatus.textContent = 'Myndaveggur br√°st: ' + err.message;
    }
  }

  async function hostingSignup(ev) {
    ev.stopPropagation();
    const hashtag = prompt('Hashtag fyrir sl√≥√∞ (d√¶mi: #omars50):', '#' + currentSlug);
    if (!hashtag) return;
    const instagramHandle = prompt('Instagram notandi (valfrj√°lst, √°n @):', '');
    const title = prompt('Heiti vi√∞bur√∞ar:', "It's My Birthday");
    const owner = prompt('Eigandi (valfrj√°lst):', '');
    try {
      const res = await fetch('/api/hosting/signup', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ hashtag, instagramHandle, title, owner })
      });
      const data = await res.json();
      if (!res.ok) throw new Error(data.error || 'Mist√≥kst a√∞ b√∫a til h√Ωsingu');
      alert('N√Ω part√Ωs√≠√∞a b√∫in til: ' + data.url + '\\nHashtag: #' + data.tenant.hashtag);
    } catch (err) {
      alert('H√Ωsing mist√≥kst: ' + err.message);
    }
  }

  async function addPhotoItem(ev) {
    ev.stopPropagation();
    if (!quizState.adminPassword) return;
    const imageUrl = prompt('Sl√≥√∞ √° mynd:');
    if (!imageUrl) return;
    const caption = prompt('Texti (valfrj√°lst):', '') || '';
    const sourceUrl = prompt('Instagram/sl√≥√∞ uppruna (valfrj√°lst):', '') || '';
    try {
      const res = await fetch('/api/photowall/item', {
        method: 'POST',
        headers: adminHeaders(),
        body: JSON.stringify({ slug: currentSlug, imageUrl, caption, sourceUrl })
      });
      const data = await res.json();
      if (!res.ok) throw new Error(data.error || 'Mist√≥kst a√∞ b√¶ta vi√∞ mynd');
      if (photoStatus) photoStatus.textContent = 'Mynd b√¶tt vi√∞.';
      await loadPhotoWall();
    } catch (err) {
      if (photoStatus) photoStatus.textContent = 'Mynd mist√≥kst: ' + err.message;
    }
  }

  async function submitPlannerApplication(ev) {
    ev.stopPropagation();
    if (!plannerType || !plannerName || !plannerContact || !plannerNote || !plannerStatus) return;

    const payload = {
      slug: currentSlug,
      type: plannerType.value || 'surprise_help',
      applicantName: plannerName.value.trim(),
      contact: plannerContact.value.trim(),
      forGuest: plannerForGuest ? plannerForGuest.value.trim() : '',
      note: plannerNote.value.trim(),
    };

    if (!payload.applicantName || !payload.contact || !payload.note) {
      plannerStatus.textContent = 'Fylltu √∫t nafn, tengili√∞ og l√Ωsingu.';
      return;
    }

    plannerStatus.textContent = 'Sendi ums√≥kn...';
    try {
      const res = await fetch('/api/planner/apply', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload),
      });
      const data = await res.json();
      if (!res.ok) throw new Error(data.error || 'Ums√≥kn mist√≥kst');
      plannerStatus.textContent = 'Ums√≥kn m√≥ttekin. Takk fyrir framlagi√∞ üéâ';
      plannerName.value = '';
      plannerContact.value = '';
      if (plannerForGuest) plannerForGuest.value = '';
      plannerNote.value = '';
    } catch (err) {
      plannerStatus.textContent = 'Ums√≥kn mist√≥kst: ' + err.message;
    }
  }

  async function startMyEventLoop(ev) {
    if (ev) ev.stopPropagation();
    if (!eventLoopStatus) return;
    if (!state.contact || !state.method) {
      eventLoopStatus.textContent = 'Skr√°√∞u √æig inn fyrst til a√∞ stofna eigi√∞ vi√∞bur√∞arforrit.';
      return;
    }
    const ownerId = ownerIdFromState();
    if (!ownerId) {
      eventLoopStatus.textContent = 'Ekki t√≥kst a√∞ lesa notandaau√∞kenni.';
      return;
    }

    const title = prompt('Heiti n√Ωs vi√∞bur√∞ar:', `${state.name || 'N√Ωtt'} part√Ω`) || '';
    if (!title.trim()) {
      eventLoopStatus.textContent = 'Vi√∞bur√∞ur ekki stofna√∞ur: vantar heiti.';
      return;
    }
    const startTime = prompt('Hven√¶r byrjar vi√∞bur√∞urinn? (ISO t√≠mi e√∞a texti):', '2026-06-19T20:00:00Z') || '';
    if (!startTime.trim()) {
      eventLoopStatus.textContent = 'Vi√∞bur√∞ur ekki stofna√∞ur: vantar upphafst√≠ma.';
      return;
    }

    if (eventLoopStartBtn) eventLoopStartBtn.disabled = true;
    eventLoopStatus.textContent = 'Stofna n√Ωtt vi√∞bur√∞arforrit...';
    try {
      const createRes = await fetch('/api/events/create', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'x-owner-id': ownerId
        },
        body: JSON.stringify({
          title: title.trim(),
          startTime: startTime.trim(),
          slug: slugify(title),
          description: 'Stofna√∞ √∫r gestas√Ωn √≠ afm√¶lisforriti',
          published: false,
          metadata: {
            sourceSlug: currentSlug
          }
        })
      });
      const createData = await createRes.json();
      if (!createRes.ok) throw new Error(createData.error || 'Stofnun mist√≥kst');

      eventLoopStatus.textContent = 'N√Ωtt vi√∞bur√∞arforrit tilb√∫i√∞: /e/' + (createData.event?.slug || createData.slug || '(√≥√æekkt-slug)');
    } catch (err) {
      eventLoopStatus.textContent = 'Stofnun mist√≥kst: ' + err.message;
    } finally {
      if (eventLoopStartBtn) eventLoopStartBtn.disabled = false;
    }
  }

  function slugify(value) {
    return String(value || '')
      .toLowerCase()
      .normalize('NFKD')
      .replace(/[\u0300-\u036f]/g, '')
      .replace(/[^a-z0-9]+/g, '-')
      .replace(/^-+|-+$/g, '')
      .slice(0, 42);
  }

  async function adminAddQuestion(ev) {
    ev.stopPropagation();
    if (!quizState.adminPassword) return;
    const yr = Number(prompt('√År (t.d. 2026):', '2026'));
    const cat = prompt('Flokkur (t.d. üéâ Part√Ω):', 'üéâ Part√Ω');
    const q = prompt('Spurningatexti:');
    const optsInput = prompt('Valkostir a√∞skildir me√∞ | (d√¶mi: A|B|C|D):');
    const ans = Number(prompt('R√©ttur valkostsv√≠sir (fr√° 0):', '0'));
    const exp = prompt('Sk√Ωring (valfrj√°lst):', 'B√¶tt vi√∞ af stj√≥rnanda.');
    const fun = prompt('Skemmtileg sta√∞reynd (valfrj√°lst):', 'S√©rsni√∞in spurning');
    if (!Number.isInteger(yr) || !cat || !q || !optsInput || !Number.isInteger(ans)) {
      quizResult.textContent = 'Stj√≥rnendavi√∞b√≥t h√¶tt vi√∞ e√∞a √≥gild innt√∂k.';
      return;
    }
    const opts = optsInput.split('|').map((x) => x.trim()).filter(Boolean);
    if (opts.length < 2) {
      quizResult.textContent = '√ûarf a√∞ minnsta kosti 2 valkosti.';
      return;
    }
    try {
      const res = await fetch('/api/quiz/admin/question', {
        method: 'POST',
        headers: adminHeaders(),
        body: JSON.stringify({ yr, cat, q, opts, ans, exp, fun })
      });
      const data = await res.json();
      if (!res.ok) throw new Error(data.error || 'Mist√≥kst a√∞ b√¶ta vi√∞ spurningu');
      quizResult.textContent = 'Spurningu b√¶tt vi√∞ me√∞ au√∞kenni ' + data.question.id + '.';
    } catch (err) {
      quizResult.textContent = 'Stj√≥rnendavi√∞b√≥t mist√≥kst: ' + err.message;
    }
  }

  async function adminDeleteQuestion(ev) {
    ev.stopPropagation();
    if (!quizState.adminPassword) return;
    const id = Number(prompt('Au√∞kenni spurningar til a√∞ ey√∞a (a√∞eins stj√≥rnendab√¶ttar):'));
    if (!Number.isInteger(id)) return;
    try {
      const res = await fetch('/api/quiz/admin/question?id=' + encodeURIComponent(String(id)), {
        method: 'DELETE',
        headers: { 'x-admin-password': quizState.adminPassword }
      });
      const data = await res.json();
      if (!res.ok) throw new Error(data.error || 'Mist√≥kst a√∞ ey√∞a spurningu');
      quizResult.textContent = 'Eyddi spurningu ' + data.id + '.';
    } catch (err) {
      quizResult.textContent = 'Ey√∞ing mist√≥kst: ' + err.message;
    }
  }

  const smsBtn = root.querySelector('[data-auth="sms"]');
  const googleBtn = root.querySelector('[data-auth="google"]');
  smsBtn.addEventListener('click', () => {
    const phone = prompt('Sl√°√∞u inn s√≠man√∫meri√∞ √æitt (fyrir SMS-innskr√°ningu):');
    if (!phone) return;
    const name = prompt('Nafn:') || 'Gestur';
    setSignedIn('sms', phone.trim(), name.trim());
  });
  googleBtn.addEventListener('click', () => {
    const email = prompt('Sl√°√∞u inn Google netfangi√∞ √æitt:');
    if (!email) return;
    const name = prompt('Nafn:') || 'Gestur';
    setSignedIn('google', email.trim().toLowerCase(), name.trim());
  });

  yesBtn.addEventListener('click', () => submitRsvp(true));
  noBtn.addEventListener('click', () => submitRsvp(false));
  if (quizStartBtn) quizStartBtn.addEventListener('click', startQuiz);
  if (quizNextBtn) quizNextBtn.addEventListener('click', nextQuizQuestion);
  if (quizAdminLoginBtn) quizAdminLoginBtn.addEventListener('click', adminLogin);
  if (quizAdminAddBtn) quizAdminAddBtn.addEventListener('click', adminAddQuestion);
  if (quizAdminDeleteBtn) quizAdminDeleteBtn.addEventListener('click', adminDeleteQuestion);
  if (adminLoginBtn) adminLoginBtn.addEventListener('click', adminLogin);
  if (adminRefreshBtn) adminRefreshBtn.addEventListener('click', refreshAdminOverview);
  if (eventLoopStartBtn) eventLoopStartBtn.addEventListener('click', startMyEventLoop);
  if (plannerSubmit) plannerSubmit.addEventListener('click', submitPlannerApplication);

  // ‚îÄ‚îÄ MySelfie ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  let selfieStream = null;
  let selfieFacingMode = 'user';

  async function startSelfieCamera() {
    if (!selfieVideo) return;
    try {
      if (selfieStream) selfieStream.getTracks().forEach(t => t.stop());
      selfieStream = await navigator.mediaDevices.getUserMedia({
        video: { facingMode: selfieFacingMode, width: { ideal: 1280 }, height: { ideal: 960 } },
        audio: false
      });
      selfieVideo.srcObject = selfieStream;
      if (selfieStatus) selfieStatus.textContent = '';
    } catch (err) {
      if (selfieStatus) selfieStatus.textContent = 'Myndav√©lin n√°√∞ist ekki: ' + err.message;
    }
  }

  if (selfieFlipBtn) selfieFlipBtn.addEventListener('click', (ev) => {
    ev.stopPropagation();
    selfieFacingMode = selfieFacingMode === 'user' ? 'environment' : 'user';
    selfieVideo.style.transform = selfieFacingMode === 'user' ? 'scaleX(-1)' : 'none';
    startSelfieCamera();
  });

  if (selfieCaptureBtn) selfieCaptureBtn.addEventListener('click', async (ev) => {
    ev.stopPropagation();
    if (!selfieVideo || !selfieCanvas || !selfieStream) {
      await startSelfieCamera();
      return;
    }
    const name = selfieName ? selfieName.value.trim() : '';
    if (!name) {
      if (selfieStatus) selfieStatus.textContent = 'Sl√°√∞u inn nafni√∞ √æitt fyrst.';
      return;
    }
    // Countdown
    if (selfieCountdown) {
      selfieCountdown.style.display = 'flex';
      for (let i = 3; i >= 1; i--) {
        selfieCountdown.textContent = String(i);
        await new Promise(r => setTimeout(r, 800));
      }
      selfieCountdown.textContent = '';
      selfieCountdown.style.display = 'none';
    }
    // Capture
    const ctx = selfieCanvas.getContext('2d');
    selfieCanvas.width = selfieVideo.videoWidth;
    selfieCanvas.height = selfieVideo.videoHeight;
    if (selfieFacingMode === 'user') {
      ctx.translate(selfieCanvas.width, 0);
      ctx.scale(-1, 1);
    }
    ctx.drawImage(selfieVideo, 0, 0);
    const imageData = selfieCanvas.toDataURL('image/jpeg', 0.7);
    const caption = selfieCaption ? selfieCaption.value.trim() : '';
    if (selfieStatus) selfieStatus.textContent = 'Sendi selfie...';
    try {
      const res = await fetch('/api/selfie/capture?slug=' + encodeURIComponent(currentSlug), {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ imageData, submittedBy: name, caption })
      });
      const data = await res.json();
      if (!res.ok) throw new Error(data.error || 'Mist√≥kst');
      if (selfieStatus) selfieStatus.textContent = 'Selfie vista√∞!';
      if (selfieCaption) selfieCaption.value = '';
      loadSelfieGallery();
    } catch (err) {
      if (selfieStatus) selfieStatus.textContent = 'Villa: ' + err.message;
    }
  });

  async function loadSelfieGallery() {
    if (!selfieGallery) return;
    try {
      const res = await fetch('/api/selfie/list?slug=' + encodeURIComponent(currentSlug));
      const data = await res.json();
      if (!res.ok) return;
      const items = data.items || [];
      if (!items.length) {
        selfieGallery.innerHTML = '<div class="muted" style="grid-column:1/-1;text-align:center;">Engin selfie enn ‚Äî taktu √æig fyrst!</div>';
        return;
      }
      selfieGallery.innerHTML = items.map(item =>
        '<img src="' + item.imageData + '" alt="Selfie fr√° ' + (item.submittedBy || '') + '" data-selfie-id="' + item.id + '" data-caption="' + (item.caption || '') + '" data-by="' + (item.submittedBy || '') + '">'
      ).join('');
      selfieGallery.querySelectorAll('img').forEach(img => {
        img.addEventListener('click', (ev) => {
          ev.stopPropagation();
          if (selfieLightbox) {
            selfieLbImg.src = img.src;
            selfieLbCaption.textContent = (img.dataset.by || '') + (img.dataset.caption ? ' ‚Äî ' + img.dataset.caption : '');
            selfieLbDownload.href = img.src;
            selfieLightbox.classList.add('open');
          }
        });
      });
    } catch {}
  }

  if (selfieLbClose) selfieLbClose.addEventListener('click', (ev) => {
    ev.stopPropagation();
    if (selfieLightbox) selfieLightbox.classList.remove('open');
  });

  // Auto-start camera when scrolling to selfie section
  const selfieSection = root.querySelector('#sec-selfie');
  if (selfieSection && selfieVideo) {
    const sObs = new IntersectionObserver((entries) => {
      if (entries[0].isIntersecting && !selfieStream) startSelfieCamera();
    }, { threshold: 0.3 });
    sObs.observe(selfieSection);
  }
  loadSelfieGallery();

  initKaraokeModule({
    root,
    currentSlug,
    karaokeTitle,
    karaokeArtist,
    karaokeAddedBy,
    karaokeFile,
    karaokeManualLyrics,
    karaokeUploadBtn,
    karaokeStatus,
    karaokeSongList,
    karaokeUploadView,
    karaokePlayerView,
    karaokeLyrics,
    karaokeAudio,
    karaokeNowTitle,
    karaokeNowArtist,
    karaokePlayBtn,
    karaokeSeek,
    karaokeTime,
    karaokeBackBtn,
    karaokeFullscreenBtn,
    karaokeFullscreen,
    karaokeFsClose,
    karaokeFsLyrics,
    karaokeChords,
    karaokeFsChords,
    karaokeFsPlay,
    karaokeFsSeek,
    karaokeFsTime,
  });

  refreshStats();
}

function initKaraokeModule({
  currentSlug,
  karaokeTitle,
  karaokeArtist,
  karaokeAddedBy,
  karaokeFile,
  karaokeManualLyrics,
  karaokeUploadBtn,
  karaokeStatus,
  karaokeSongList,
  karaokeUploadView,
  karaokePlayerView,
  karaokeLyrics,
  karaokeAudio,
  karaokeNowTitle,
  karaokeNowArtist,
  karaokePlayBtn,
  karaokeSeek,
  karaokeTime,
  karaokeBackBtn,
  karaokeFullscreenBtn,
  karaokeFullscreen,
  karaokeFsClose,
  karaokeFsLyrics,
  karaokeChords,
  karaokeFsChords,
  karaokeFsPlay,
  karaokeFsSeek,
  karaokeFsTime,
}) {
  let karaokeFileData = null;
  let karaokeLyricsData = [];
  let karaokeAnimFrame = null;

  const karaokeApi = {
    async listSongs() {
      const res = await fetch('/api/karaoke/songs?slug=' + encodeURIComponent(currentSlug));
      const data = await res.json();
      if (!res.ok) throw new Error(data.error || 'Gat ekki hla√∞i√∞ l√∂gum');
      return data.songs || [];
    },
    async getSongMeta(songId) {
      const res = await fetch('/api/karaoke/song?slug=' + encodeURIComponent(currentSlug) + '&id=' + songId);
      const data = await res.json();
      if (!res.ok) throw new Error(data.error || 'Lag fannst ekki');
      return data;
    },
    async getSongAudio(songId) {
      const res = await fetch('/api/karaoke/audio?slug=' + encodeURIComponent(currentSlug) + '&id=' + songId);
      const data = await res.json();
      if (!res.ok) throw new Error(data.error || 'Hlj√≥√∞ fannst ekki');
      return data.audioBase64;
    },
  };

  const karaokeRender = {
    chords(song) {
      const blocks = [karaokeChords, karaokeFsChords].filter(Boolean);
      blocks.forEach((container) => {
        if (!song || !Array.isArray(song.chords) || !song.chords.length) {
          container.innerHTML = '<div class="muted" style="font-size:0.78rem;">Engin g√≠targrip skr√°√∞ fyrir √æetta lag.</div>';
          return;
        }
        container.innerHTML = [
          '<div style="font-size:0.74rem; color:var(--text-muted); text-transform:uppercase; letter-spacing:0.08em;">G√≠targrip</div>',
          '<div class="row">' + song.chords.map((ch) => '<span class="karaoke-chord">' + ch + '</span>').join('') + '</div>'
        ].join('');
      });
    },
    lyrics(container, lyrics, manualLyrics) {
      if (!container) return;
      if (lyrics && lyrics.length) {
        container.innerHTML = lyrics.map((w, i) =>
          '<span class="word" data-word-idx="' + i + '">' + w.word + '</span>'
        ).join(' ');
      } else if (manualLyrics) {
        container.innerHTML = manualLyrics.split('\n').map((line) =>
          '<div style="margin-bottom:0.5em;">' + line + '</div>'
        ).join('');
      } else {
        container.innerHTML = '<div class="muted">Enginn lagatexti tilt√¶kur</div>';
      }
    },
    songList(songs, onSelect) {
      if (!karaokeSongList) return;
      karaokeSongList.innerHTML = songs.map((s) =>
        '<div class="karaoke-song-item" data-song-id="' + s.id + '">' +
          '<div class="song-info"><div class="song-title">' + s.title + '</div>' +
          '<div class="song-artist">' + (s.artist || s.addedBy) + '</div></div>' +
          '<span class="karaoke-badge ' + s.status + '">' +
          (s.status === 'ready' ? 'Tilb√∫i√∞' : s.status === 'transcribing' ? 'Umritun...' : s.status === 'error' ? 'Villa' : 'Hla√∞i√∞') +
          '</span></div>'
      ).join('');
      karaokeSongList.querySelectorAll('.karaoke-song-item').forEach((el) => {
        el.addEventListener('click', (ev) => {
          ev.stopPropagation();
          onSelect(el.dataset.songId);
        });
      });
    },
  };

  const karaokePlayback = {
    sync(currentTime) {
      if (!karaokeLyricsData.length) return;
      const containers = [karaokeLyrics, karaokeFsLyrics].filter(Boolean);
      containers.forEach((container) => {
        const words = container.querySelectorAll('.word');
        words.forEach((el, i) => {
          const w = karaokeLyricsData[i];
          if (!w) return;
          el.classList.remove('active', 'past');
          if (currentTime >= w.start && currentTime <= w.end) el.classList.add('active');
          else if (currentTime > w.end) el.classList.add('past');
        });
        const activeEl = container.querySelector('.word.active');
        if (activeEl) activeEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
      });
    },
    startSyncLoop() {
      if (karaokeAnimFrame) cancelAnimationFrame(karaokeAnimFrame);
      function loop() {
        if (karaokeAudio && !karaokeAudio.paused) {
          karaokePlayback.sync(karaokeAudio.currentTime);
          const dur = karaokeAudio.duration || 1;
          const pct = (karaokeAudio.currentTime / dur) * 100;
          if (karaokeSeek) karaokeSeek.value = pct;
          if (karaokeFsSeek) karaokeFsSeek.value = pct;
          const m = Math.floor(karaokeAudio.currentTime / 60);
          const s = Math.floor(karaokeAudio.currentTime % 60);
          const timeStr = m + ':' + String(s).padStart(2, '0');
          if (karaokeTime) karaokeTime.textContent = timeStr;
          if (karaokeFsTime) karaokeFsTime.textContent = timeStr;
        }
        karaokeAnimFrame = requestAnimationFrame(loop);
      }
      loop();
    },
    togglePlay() {
      if (!karaokeAudio || !karaokeAudio.src) return;
      if (karaokeAudio.paused) {
        karaokeAudio.play();
        if (karaokePlayBtn) karaokePlayBtn.innerHTML = '&#10074;&#10074;';
        if (karaokeFsPlay) karaokeFsPlay.innerHTML = '&#10074;&#10074;';
        karaokePlayback.startSyncLoop();
      } else {
        karaokeAudio.pause();
        if (karaokePlayBtn) karaokePlayBtn.innerHTML = '&#9654;';
        if (karaokeFsPlay) karaokeFsPlay.innerHTML = '&#9654;';
      }
    },
  };

  if (karaokeFile) karaokeFile.addEventListener('change', (ev) => {
    ev.stopPropagation();
    const file = karaokeFile.files[0];
    if (!file) { karaokeFileData = null; if (karaokeUploadBtn) karaokeUploadBtn.disabled = true; return; }
    if (file.size > 10 * 1024 * 1024) {
      if (karaokeStatus) karaokeStatus.textContent = 'Skr√° of st√≥r (h√°mark 10MB)';
      karaokeFileData = null;
      return;
    }
    const reader = new FileReader();
    reader.onload = () => {
      karaokeFileData = reader.result;
      if (karaokeUploadBtn) karaokeUploadBtn.disabled = false;
      if (karaokeStatus) karaokeStatus.textContent = file.name + ' (' + (file.size / 1024 / 1024).toFixed(1) + ' MB)';
    };
    reader.readAsDataURL(file);
  });

  if (karaokeUploadBtn) karaokeUploadBtn.addEventListener('click', async (ev) => {
    ev.stopPropagation();
    const title = karaokeTitle ? karaokeTitle.value.trim() : '';
    const artist = karaokeArtist ? karaokeArtist.value.trim() : '';
    const addedBy = karaokeAddedBy ? karaokeAddedBy.value.trim() : '';
    const manualLyrics = karaokeManualLyrics ? karaokeManualLyrics.value.trim() : '';
    if (!title || !addedBy) {
      if (karaokeStatus) karaokeStatus.textContent = 'Heiti lags og nafn eru nau√∞synleg.';
      return;
    }
    if (!karaokeFileData && !manualLyrics) {
      if (karaokeStatus) karaokeStatus.textContent = 'Veldu hlj√≥√∞skr√° e√∞a l√≠mdu lagatexta.';
      return;
    }
    karaokeUploadBtn.disabled = true;
    if (karaokeStatus) karaokeStatus.textContent = 'Hle√∞ upp...';
    try {
      if (karaokeFileData) {
        const res = await fetch('/api/karaoke/upload?slug=' + encodeURIComponent(currentSlug), {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ title, artist, addedBy, audioBase64: karaokeFileData })
        });
        const data = await res.json();
        if (!res.ok) throw new Error(data.error || 'Mist√≥kst');
        if (karaokeStatus) karaokeStatus.textContent = 'Lag hla√∞i√∞ upp! Umritun √≠ gangi...';
        try {
          await fetch('/api/karaoke/transcribe?slug=' + encodeURIComponent(currentSlug) + '&id=' + data.song.id, { method: 'POST' });
        } catch {}
        if (manualLyrics) {
          await fetch('/api/karaoke/lyrics?slug=' + encodeURIComponent(currentSlug) + '&id=' + data.song.id, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ lyrics: manualLyrics })
          });
        }
      } else if (manualLyrics) {
        if (karaokeStatus) karaokeStatus.textContent = 'Lagatexti eing√∂ngu ‚Äî hlj√≥√∞skr√° vantar til a√∞ spila.';
      }
      if (karaokeTitle) karaokeTitle.value = '';
      if (karaokeArtist) karaokeArtist.value = '';
      if (karaokeManualLyrics) karaokeManualLyrics.value = '';
      karaokeFileData = null;
      if (karaokeFile) karaokeFile.value = '';
      loadKaraokeSongs();
    } catch (err) {
      if (karaokeStatus) karaokeStatus.textContent = 'Villa: ' + err.message;
    }
    karaokeUploadBtn.disabled = true;
  });

  async function loadKaraokeSongs() {
    if (!karaokeSongList) return;
    try {
      const songs = await karaokeApi.listSongs();
      karaokeRender.songList(songs, openKaraokePlayer);
    } catch {}
  }

  async function openKaraokePlayer(songId) {
    if (!karaokePlayerView || !karaokeAudio) return;
    try {
      const meta = await karaokeApi.getSongMeta(songId);
      karaokeLyricsData = meta.lyrics || [];
      if (karaokeNowTitle) karaokeNowTitle.textContent = meta.title;
      if (karaokeNowArtist) karaokeNowArtist.textContent = meta.artist || meta.addedBy || '';
      karaokeAudio.pause();
      if (meta.hasAudio) {
        karaokeAudio.src = await karaokeApi.getSongAudio(songId);
        karaokeAudio.load();
        if (karaokePlayBtn) karaokePlayBtn.disabled = false;
        if (karaokeFsPlay) karaokeFsPlay.disabled = false;
      } else {
        karaokeAudio.src = '';
        karaokeAudio.load();
        if (karaokePlayBtn) karaokePlayBtn.disabled = true;
        if (karaokeFsPlay) karaokeFsPlay.disabled = true;
        if (karaokeStatus) karaokeStatus.textContent = '√ûetta lag er texti+grip (engin hlj√≥√∞skr√° tengd).';
      }
      if (karaokePlayBtn) karaokePlayBtn.innerHTML = '&#9654;';
      if (karaokeFsPlay) karaokeFsPlay.innerHTML = '&#9654;';
      karaokeRender.lyrics(karaokeLyrics, karaokeLyricsData, meta.manualLyrics);
      if (karaokeFsLyrics) karaokeRender.lyrics(karaokeFsLyrics, karaokeLyricsData, meta.manualLyrics);
      karaokeRender.chords(meta);
      karaokePlayerView.classList.add('active');
      if (karaokeUploadView) karaokeUploadView.style.display = 'none';
    } catch {}
  }

  if (karaokePlayBtn) karaokePlayBtn.addEventListener('click', (ev) => { ev.stopPropagation(); karaokePlayback.togglePlay(); });
  if (karaokeFsPlay) karaokeFsPlay.addEventListener('click', (ev) => { ev.stopPropagation(); karaokePlayback.togglePlay(); });

  [karaokeSeek, karaokeFsSeek].forEach((seek) => {
    if (seek) seek.addEventListener('input', (ev) => {
      ev.stopPropagation();
      if (karaokeAudio && karaokeAudio.duration) karaokeAudio.currentTime = (seek.value / 100) * karaokeAudio.duration;
    });
  });

  if (karaokeBackBtn) karaokeBackBtn.addEventListener('click', (ev) => {
    ev.stopPropagation();
    if (karaokeAudio) { karaokeAudio.pause(); karaokeAudio.src = ''; }
    if (karaokeAnimFrame) cancelAnimationFrame(karaokeAnimFrame);
    if (karaokePlayerView) karaokePlayerView.classList.remove('active');
    if (karaokeUploadView) karaokeUploadView.style.display = '';
    if (karaokePlayBtn) karaokePlayBtn.innerHTML = '&#9654;';
    if (karaokePlayBtn) karaokePlayBtn.disabled = false;
    if (karaokeFsPlay) karaokeFsPlay.disabled = false;
    karaokeRender.chords(null);
    loadKaraokeSongs();
  });

  if (karaokeFullscreenBtn) karaokeFullscreenBtn.addEventListener('click', (ev) => {
    ev.stopPropagation();
    if (karaokeFullscreen) karaokeFullscreen.classList.add('open');
  });
  if (karaokeFsClose) karaokeFsClose.addEventListener('click', (ev) => {
    ev.stopPropagation();
    if (karaokeFullscreen) karaokeFullscreen.classList.remove('open');
  });

  if (karaokeAudio) karaokeAudio.addEventListener('ended', () => {
    if (karaokePlayBtn) karaokePlayBtn.innerHTML = '&#9654;';
    if (karaokeFsPlay) karaokeFsPlay.innerHTML = '&#9654;';
  });

  karaokeRender.chords(null);
  loadKaraokeSongs();
}

function initThemeSelector() {
  const root = document.documentElement;
  const storageKey = 'myx-family-theme';
  const defaultTheme = 'bond';
  const themes = {
    bond: {
      bg: '#0d0f14', surface: '#161a22', surfaceHover: '#202735', text: '#f9fafb', textMuted: '#a8b1c2',
      border: '#2a3242', borderLight: '#3a465c', primary: '#d4af37', primaryText: '#0a0b10', secondary: '#6b7280',
      accent: '#f5d77a', danger: '#e05252', success: '#2fb36d', warning: '#d99b24',
      shadow: 'rgba(0, 0, 0, 0.52)', glow: 'rgba(212, 175, 55, 0.26)',
      gradient: 'linear-gradient(160deg, rgba(212, 175, 55, 0.16), rgba(20, 24, 35, 0.92))'
    },
    deathBecomesHer: {
      bg: '#120b1b', surface: '#1d1230', surfaceHover: '#2a1a43', text: '#f9ecff', textMuted: '#c7addb',
      border: '#4a2f67', borderLight: '#6a4a8a', primary: '#d946ef', primaryText: '#13081d', secondary: '#7b638f',
      accent: '#22d3ee', danger: '#fb7185', success: '#34d399', warning: '#fbbf24',
      shadow: 'rgba(13, 6, 20, 0.56)', glow: 'rgba(217, 70, 239, 0.26)',
      gradient: 'linear-gradient(160deg, rgba(217, 70, 239, 0.18), rgba(18, 11, 27, 0.94))'
    },
    pinkPanther: {
      bg: '#130e16', surface: '#1e1725', surfaceHover: '#2a2035', text: '#fff4fb', textMuted: '#d9b6cd',
      border: '#5a3d54', borderLight: '#7a5472', primary: '#f472b6', primaryText: '#1b0f18', secondary: '#8e7085',
      accent: '#fb7185', danger: '#ef4444', success: '#22c55e', warning: '#f59e0b',
      shadow: 'rgba(18, 10, 16, 0.5)', glow: 'rgba(244, 114, 182, 0.24)',
      gradient: 'linear-gradient(160deg, rgba(244, 114, 182, 0.18), rgba(19, 14, 22, 0.94))'
    },
    retro80s: {
      bg: '#0b0d18', surface: '#151a2b', surfaceHover: '#1f2742', text: '#eef2ff', textMuted: '#aab5d9',
      border: '#30406b', borderLight: '#455a91', primary: '#22d3ee', primaryText: '#0a0f1a', secondary: '#6b7ba9',
      accent: '#a78bfa', danger: '#fb7185', success: '#34d399', warning: '#fbbf24',
      shadow: 'rgba(8, 10, 20, 0.58)', glow: 'rgba(34, 211, 238, 0.28)',
      gradient: 'linear-gradient(160deg, rgba(34, 211, 238, 0.18), rgba(167, 139, 250, 0.14), rgba(11, 13, 24, 0.96))'
    }
  };
  const saved = localStorage.getItem(storageKey) || defaultTheme;

  function apply(name) {
    const safe = themes[name] ? name : defaultTheme;
    const theme = themes[safe];
    root.style.setProperty('--bg', theme.bg);
    root.style.setProperty('--surface', theme.surface);
    root.style.setProperty('--surface-hover', theme.surfaceHover);
    root.style.setProperty('--text', theme.text);
    root.style.setProperty('--text-muted', theme.textMuted);
    root.style.setProperty('--border', theme.border);
    root.style.setProperty('--border-light', theme.borderLight);
    root.style.setProperty('--primary', theme.primary);
    root.style.setProperty('--primary-text', theme.primaryText);
    root.style.setProperty('--secondary', theme.secondary);
    root.style.setProperty('--accent', theme.accent);
    root.style.setProperty('--danger', theme.danger);
    root.style.setProperty('--success', theme.success);
    root.style.setProperty('--warning', theme.warning);
    root.style.setProperty('--shadow', theme.shadow);
    root.style.setProperty('--glow', theme.glow);
    root.style.setProperty('--gradient', theme.gradient);
    root.setAttribute('data-theme', safe);
    localStorage.setItem(storageKey, safe);
    document.querySelectorAll('[data-theme-select]').forEach((el) => {
      el.classList.toggle('active', el.getAttribute('data-theme-select') === safe);
    });
  }
  apply(saved);
  if (!window.__THEME_PICKER_BOUND__) {
    document.addEventListener('click', (event) => {
      const el = event.target && event.target.closest ? event.target.closest('[data-theme-select]') : null;
      if (!el) return;
      event.stopPropagation();
      apply(el.getAttribute('data-theme-select'));
    });
    window.__THEME_PICKER_BOUND__ = true;
  }
}

function startCountdown() {
  const target = new Date('2026-06-19T00:00:00');
  const digitEls = {};
  ['d0','d1','d2','h0','h1','m0','m1','s0','s1'].forEach(k => {
    digitEls[k] = document.querySelectorAll('[data-cd="' + k + '"]');
  });
  const prev = {};
  function setDigit(key, val) {
    const v = String(val);
    if (prev[key] !== v) {
      prev[key] = v;
      digitEls[key].forEach(el => {
        el.textContent = v;
        el.classList.remove('tick');
        void el.offsetWidth;
        el.classList.add('tick');
      });
    }
  }
  function tick() {
    const now = new Date();
    const diff = target.getTime() - now.getTime();
    if (diff <= 0) {
      const grids = document.querySelectorAll('[data-countdown]');
      grids.forEach(g => { g.innerHTML = '<div style="font-size:1rem;text-align:center;padding:0.5rem 0;color:var(--accent);">Til hamingju me√∞ afm√¶li√∞!</div>'; });
      return;
    }
    const d = Math.floor(diff / 86400000);
    const h = Math.floor((diff % 86400000) / 3600000);
    const m = Math.floor((diff % 3600000) / 60000);
    const s = Math.floor((diff % 60000) / 1000);
    const ds = String(d).padStart(3, '0');
    setDigit('d0', ds[0]); setDigit('d1', ds[1]); setDigit('d2', ds[2]);
    const hs = String(h).padStart(2, '0');
    setDigit('h0', hs[0]); setDigit('h1', hs[1]);
    const ms = String(m).padStart(2, '0');
    setDigit('m0', ms[0]); setDigit('m1', ms[1]);
    const ss = String(s).padStart(2, '0');
    setDigit('s0', ss[0]); setDigit('s1', ss[1]);
  }
  tick();
  setInterval(tick, 1000);
}

initThemeSelector();

function initDesktopGiftReveal() {
  if (window.innerWidth <= 768) return;
  const wrapper = document.querySelector('.desktop-wrapper');
  if (!wrapper) return;
  const openBtn = document.querySelector('[data-open-gift]');
  const openGift = () => wrapper.classList.add('gift-open');
  if (openBtn) {
    openBtn.addEventListener('click', (ev) => {
      ev.stopPropagation();
      openGift();
    });
  }
  setTimeout(openGift, 1400);
}
initDesktopGiftReveal();

if (window.innerWidth > 768) {
  const src = document.getElementById('appContent');
  const dest = document.getElementById('phoneContent');
  if (src && dest) {
    dest.innerHTML = src.innerHTML;
    src.style.display = 'none';
    initInteractions(dest);
  }
} else {
  initInteractions(document.getElementById('appContent'));
}
startCountdown();

function initRetroBackground() {
  const bg = document.querySelector('.retro-bg');
  const badge = document.querySelector('[data-retro-badge]');
  if (!bg) return;
  bg.innerHTML = '';
  const total = window.innerWidth > 768 ? 42 : 28;
  for (let i = 0; i < total; i++) {
    const sprite = document.createElement('span');
    sprite.className = 'retro-sprite ' + (i % 3 === 0 ? 'star' : 'coin');
    sprite.style.left = (Math.random() * 100).toFixed(2) + '%';
    sprite.style.animationDuration = (8 + Math.random() * 12).toFixed(2) + 's';
    sprite.style.animationDelay = (-Math.random() * 12).toFixed(2) + 's';
    bg.appendChild(sprite);
  }
  if (badge) badge.textContent = 'HANN √Å AFM√ÜLI √ç DAG ‚Ä¢ RETRO MODE';
}
initRetroBackground();

const observer = new IntersectionObserver((entries) => {
  entries.forEach((entry) => {
    if (entry.isIntersecting) {
      entry.target.classList.add('visible');
      observer.unobserve(entry.target);
    }
  });
}, { threshold: 0.1, rootMargin: '0px 0px -50px 0px' });

document.querySelectorAll('.animate-on-scroll').forEach((el) => observer.observe(el));

const phoneContent = document.getElementById('phoneContent');
if (phoneContent) {
  const phoneObserver = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        entry.target.classList.add('visible');
        phoneObserver.unobserve(entry.target);
      }
    });
  }, { threshold: 0.1, root: phoneContent });
  phoneContent.querySelectorAll('.animate-on-scroll').forEach((el) => phoneObserver.observe(el));
}
</script>
</body>
</html>
